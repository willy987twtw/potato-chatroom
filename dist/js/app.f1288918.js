(function(e){function t(t){for(var r,u,s=t[0],o=t[1],i=t[2],d=0,b=[];d<s.length;d++)u=s[d],Object.prototype.hasOwnProperty.call(a,u)&&a[u]&&b.push(a[u][0]),a[u]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);l&&l(t);while(b.length)b.shift()();return c.push.apply(c,i||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,s=1;s<n.length;s++){var o=n[s];0!==a[o]&&(r=!1)}r&&(c.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},a={app:0},c=[];function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var i=0;i<s.length;i++)t(s[i]);var l=o;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},"1d87":function(e,t,n){"use strict";n("c6c1")},"1e68":function(e,t,n){},"1eec":function(e,t,n){},2:function(e,t){},"25a2":function(e,t,n){"use strict";n("a05a")},3:function(e,t){},"320b":function(e,t,n){"use strict";n("4df4")},"37b6":function(e,t,n){"use strict";n("8de3")},"3a40":function(e,t,n){"use strict";n("6308")},"3b1d":function(e,t,n){"use strict";n("1eec")},"3e42":function(e,t,n){},4:function(e,t){},"413f":function(e,t,n){},"45fc":function(e,t,n){"use strict";n("413f")},"4c3d":function(e,t,n){},"4df4":function(e,t,n){},"4fa4":function(e,t,n){"use strict";n("c753")},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function a(e,t,n,a,c,u){var s=Object(r["A"])("router-view"),o=Object(r["A"])("vue100vh");return Object(r["u"])(),Object(r["d"])(o,{class:"container",css:{height:"100rvh"}},{default:Object(r["H"])((function(){return[Object(r["i"])(s)]})),_:1})}var c=n("1859"),u={components:{vue100vh:c["a"]},setup:function(){}},s=(n("e3d1"),n("6b0d")),o=n.n(s);const i=o()(u,[["render",a]]);var l=i,d=n("6c02"),b=n("cf05"),f=n.n(b),p={"welcom-form":""},v=Object(r["g"])("div",{class:"header"},[Object(r["g"])("img",{class:"logo",src:f.a,alt:"potato chatroom"}),Object(r["g"])("h1",null,"馬鈴薯聊天室")],-1),m={class:"welcome container"},O={key:0,class:"login-form"},j=Object(r["g"])("h3",null,"登入帳號",-1),h=Object(r["h"])("還沒有帳號？ "),g={key:1,class:"signup-form"},w=Object(r["g"])("h3",null,"註冊帳號",-1),y=Object(r["h"])("已經有帳號了？ ");function x(e,t,n,a,c,u){var s=Object(r["A"])("loginForm"),o=Object(r["A"])("SignupForm");return Object(r["u"])(),Object(r["f"])("div",p,[v,Object(r["g"])("div",m,[a.showLogin?(Object(r["u"])(),Object(r["f"])("div",O,[j,Object(r["i"])(s,{onLogin:a.enterChatroom},null,8,["onLogin"]),Object(r["g"])("p",null,[h,Object(r["g"])("span",{onClick:t[0]||(t[0]=function(e){return a.showLogin=!1})},"註冊帳號")])])):(Object(r["u"])(),Object(r["f"])("div",g,[w,Object(r["i"])(o),Object(r["g"])("p",null,[y,Object(r["g"])("span",{onClick:t[1]||(t[1]=function(e){return a.showLogin=!0})},"登入帳號")])]))])])}var k=n("a1e9"),R={class:"inputs"},I={class:"error"},C={key:0},A={key:1,disabled:""};function L(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("form",{onSubmit:t[2]||(t[2]=Object(r["K"])((function(){return a.handleSubmit&&a.handleSubmit.apply(a,arguments)}),["prevent"]))},[Object(r["g"])("div",R,[Object(r["I"])(Object(r["g"])("input",{type:"email",required:"",placeholder:"電子郵件帳號","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.email=e}),autocomplete:"off"},null,512),[[r["E"],a.email]]),Object(r["I"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"密碼","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.password=e}),autocomplete:"off"},null,512),[[r["E"],a.password]])]),Object(r["g"])("div",I,Object(r["C"])(a.error),1),a.isPending?Object(r["e"])("",!0):(Object(r["u"])(),Object(r["f"])("button",C,"登入")),a.isPending?(Object(r["u"])(),Object(r["f"])("button",A,"登入中...")):Object(r["e"])("",!0)],32)}var D=n("1da1"),S=(n("96cf"),n("260b")),P=(n("e71f"),n("ea7b"),n("66ce"),{apiKey:"AIzaSyDJsSy-Yx5kA95C4ixotoreAOoCSDX6Twg",authDomain:"potato-chatroom.firebaseapp.com",projectId:"potato-chatroom",storageBucket:"potato-chatroom.appspot.com",messagingSenderId:"570591132864",appId:"1:570591132864:web:8572d473306e8555138125"});S["a"].initializeApp(P);var q=S["a"].auth(),N=S["a"].firestore(),E=(S["a"].database(),S["a"].firestore.FieldValue.serverTimestamp),M=(S["a"].firestore.FieldPath,Object(k["l"])(null)),F=Object(k["l"])(!1),U=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M.value="",F.value=!0,e.prev=2,e.next=5,q.signInWithEmailAndPassword(t,n);case 5:return r=e.sent,M.value=null,F.value=!1,e.abrupt("return",r);case 11:e.prev=11,e.t0=e["catch"](2),console.log(e.t0.message),M.value="帳號或密碼無效，請再輸入一次",F.value=!1;case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t,n){return e.apply(this,arguments)}}(),W=function(){return{error:M,login:U,isPending:F}},V=W,K=Object(k["l"])(q.currentUser);q.onAuthStateChanged((function(e){K.value=e}));var _=function(){return{user:K}},H=_,Q=function(e,t){var n=Object(r["x"])(null),a=Object(r["x"])(!1),c=N.collection(e).doc(t),u=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a.value=!0,n.value=null;try{c.set(t)}catch(r){console.log(r.message),n.value="無法新增資料，請再試一次",a.value=!1}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=!0,n.value=null,e.prev=2,e.next=5,c.delete();case 5:return t=e.sent,a.value=!1,e.abrupt("return",t);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),n.value="無法刪除資料，請再試一次",a.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),o=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=!0,n.value=null,e.prev=2,e.next=5,c.update(t);case 5:return r=e.sent,a.value=!1,e.abrupt("return",r);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),n.value="無法更新資料，請再試一次",a.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}();return{error:n,isPending:a,document:document,deleteDoc:s,updateDoc:o,addDoc:u}},T=Q,z={components:{useLogin:V,getUser:H,useDocuments:T},setup:function(e,t){var n=Object(k["l"])(""),r=Object(k["l"])(""),a=V(),c=a.error,u=a.login,s=a.isPending,o=H(),i=(o.user,function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u(n.value,r.value);case 2:c.value||t.emit("login");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());return{email:n,password:r,handleSubmit:i,error:c,isPending:s}}};n("9d68");const J=o()(z,[["render",L]]);var B=J,G={class:"inputs"},X={class:"error"},Y={key:0},Z={key:1,disabled:""};function $(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("form",{onSubmit:t[3]||(t[3]=Object(r["K"])((function(){return a.handleSubmit&&a.handleSubmit.apply(a,arguments)}),["prevent"]))},[Object(r["g"])("div",G,[Object(r["I"])(Object(r["g"])("input",{type:"text",required:"",placeholder:"暱稱 (最多10字，日後可修改)","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.displayName=e}),autocomplete:"off",maxlength:"10"},null,512),[[r["E"],a.displayName]]),Object(r["I"])(Object(r["g"])("input",{type:"email",required:"",placeholder:"電子郵件帳號","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.email=e}),autocomplete:"off"},null,512),[[r["E"],a.email]]),Object(r["I"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"密碼","onUpdate:modelValue":t[2]||(t[2]=function(e){return a.password=e}),autocomplete:"off"},null,512),[[r["E"],a.password]])]),Object(r["g"])("div",X,Object(r["C"])(a.error),1),a.isPending?Object(r["e"])("",!0):(Object(r["u"])(),Object(r["f"])("button",Y,"註冊")),a.isPending?(Object(r["u"])(),Object(r["f"])("button",Z,"註冊中...")):Object(r["e"])("",!0)],32)}var ee=Object(k["l"])(null),te=Object(k["l"])(!1),ne=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return ee.value=null,te.value=!0,e.prev=2,e.next=5,q.createUserWithEmailAndPassword(t,n);case 5:if(a=e.sent,a){e.next=8;break}throw new Error("無法完成註冊");case 8:return e.next=10,a.user.updateProfile({displayName:r});case 10:return te.value=!1,e.abrupt("return",a);case 14:e.prev=14,e.t0=e["catch"](2),console.log(e.t0.message),ee.value=e.t0.message,te.value=!1;case 19:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(t,n,r){return e.apply(this,arguments)}}(),re=function(){return{error:ee,signup:ne,isPending:te}},ae=re,ce=function(e){var t=Object(k["l"])(null),n=function(){var n=Object(D["a"])(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.value=null,n.prev=1,n.next=4,N.collection(e).add(r);case 4:n.next=10;break;case 6:n.prev=6,n.t0=n["catch"](1),console.log(n.t0.message),t.value="could not send the message";case 10:case"end":return n.stop()}}),n,null,[[1,6]])})));return function(e){return n.apply(this,arguments)}}(),r=function(){var n=Object(D["a"])(regeneratorRuntime.mark((function n(r,a){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.value=null,n.prev=1,n.next=4,N.collection(e).doc(r).set(a);case 4:n.next=10;break;case 6:n.prev=6,n.t0=n["catch"](1),console.log(n.t0.message),t.value="could not send the message";case 10:case"end":return n.stop()}}),n,null,[[1,6]])})));return function(e,t){return n.apply(this,arguments)}}();return{error:t,addDoc:n,addDocWithId:r}},ue=ce,se=function(e,t,n){var a=Object(r["x"])(null),c=Object(r["x"])(!1),u=N.collection(e).doc(t).collection(n),s=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c.value=!0,a.value=null;try{u.add(t)}catch(n){console.log(n.message),a.value="無法新增資料，請再試一次",c.value=!1}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return c.value=!0,a.value=null,e.prev=2,e.next=5,u.doc(t).delete();case 5:return n=e.sent,c.value=!1,e.abrupt("return",n);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),a.value="無法刪除資料，請再試一次",c.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return c.value=!0,a.value=null,e.prev=2,e.next=5,u.doc(t).update(n);case 5:return r=e.sent,c.value=!1,e.abrupt("return",r);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),a.value="無法更新資料，請再試一次",c.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=null,e.prev=1,e.next=4,u.doc(t).set(n);case 4:return r=e.sent,c.value=!1,e.abrupt("return",r);case 9:e.prev=9,e.t0=e["catch"](1),console.log(e.t0.message),a.value="could not send the message";case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}();return{error:a,isPending:c,document:document,deleteDoc:o,updateDoc:i,addDoc:s,addDocWithId:l}},oe=se,ie={components:{useCollection:ue},setup:function(){var e=Object(k["l"])(""),t=Object(k["l"])(""),n=Object(k["l"])(""),r=ae(),a=r.error,c=r.signup,u=r.isPending,s=ue("users"),o=s.addDocWithId,i=H(),l=i.user,b=Object(d["d"])(),f=function(){var r=Object(D["a"])(regeneratorRuntime.mark((function r(){var u,s,i,d,f,p;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,c(e.value,t.value,n.value);case 2:if(a.value){r.next=15;break}return r.next=5,o(l.value.uid,{displayName:l.value.displayName,userId:l.value.uid,statusMessage:"尚未設定狀態",requestIsRead:!0,messageIsRead:!0});case 5:return u=oe("users",l.value.uid,"friendRequests"),s=u.addDocWithId,i=oe("users","pvzcHUVscLOjoAOK0eQQxHx3qOV2","sentRequests"),d=i.addDocWithId,f=T("users",l.value.uid),p=f.updateDoc,b.push({name:"Chatroom",params:{id:"friendList"}}),r.next=11,p({requestIsRead:!1});case 11:return r.next=13,s("pvzcHUVscLOjoAOK0eQQxHx3qOV2",{displayName:"製作人小汪",userId:"pvzcHUVscLOjoAOK0eQQxHx3qOV2"});case 13:return r.next=15,d(l.value.uid,{userId:l.value.uid});case 15:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return{email:e,password:t,handleSubmit:f,displayName:n,error:a,signup:c,isPending:u}}};n("3b1d");const le=o()(ie,[["render",$]]);var de=le,be={components:{LoginForm:B,SignupForm:de,getUser:H},setup:function(){var e=Object(k["l"])(!0),t=Object(d["d"])(),n=function(){t.push({name:"Chatroom",params:{id:"friendList"}})};return{showLogin:e,enterChatroom:n}}};n("1d87");const fe=o()(be,[["render",x]]);var pe=fe,ve={class:"chatroom"};function me(e,t,n,a,c,u){var s=Object(r["A"])("Navbar"),o=Object(r["A"])("Sidebar"),i=Object(r["A"])("Friends"),l=Object(r["A"])("SingleChatroom");return Object(r["u"])(),Object(r["f"])("div",ve,[Object(r["i"])(s),Object(r["i"])(o),Object(r["i"])(i),Object(r["i"])(l)])}var Oe={key:0,class:"navbar"},je={class:"display-name"},he={class:"email"};function ge(e,t,n,a,c,u){return a.user&&a.userInfo?(Object(r["u"])(),Object(r["f"])("nav",Oe,[Object(r["g"])("div",null,[Object(r["g"])("p",je,"您好，"+Object(r["C"])(a.userInfo.displayName),1),Object(r["g"])("p",he,Object(r["C"])(a.user.email),1)]),Object(r["g"])("button",{onClick:t[0]||(t[0]=function(){return a.handleClick&&a.handleClick.apply(a,arguments)})},"登出")])):Object(r["e"])("",!0)}var we=Object(k["l"])(null),ye=Object(k["l"])(!1),xe=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return we.value=null,ye.value=!0,e.prev=2,e.next=5,q.signOut();case 5:ye.value=!1,e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](2),console.log(e.t0.message),we.value=e.t0.message,ye.value=!1;case 13:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),ke=function(){return{logout:xe,error:we,isPending:ye}},Re=ke,Ie=n("5530"),Ce=function(e,t){var n=Object(r["x"])(null),a=Object(r["x"])(null),c=N.collection(e).doc(t),u=c.onSnapshot((function(e){e.data()?(n.value=Object(Ie["a"])(Object(Ie["a"])({},e.data()),{},{id:e.id}),a.value=null):(a.value="此資料不存在。",n.value=null)}),(function(e){console.log(e.message),a.value="無法取得資料"}));return Object(r["G"])((function(e){e((function(){return u()}))})),{document:n,error:a}},Ae=Ce,Le={components:{useLogout:Re},setup:function(){var e=Re(),t=e.logout,n=e.error,r=Object(d["d"])(),a=H(),c=a.user,u=Ae("users",c.value.uid),s=u.document,o=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:n.value||r.push({name:"Welcome"});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{user:c,handleClick:o,userInfo:s}}};n("eec7");const De=o()(Le,[["render",ge]]);var Se=De,Pe={class:"sidebar"},qe={class:"buttons"},Ne=Object(r["h"])(" people "),Ee=Object(r["g"])("p",null,"好友",-1),Me=[Ne,Ee],Fe=Object(r["h"])(" question_answer "),Ue=Object(r["g"])("p",null,"聊天室",-1),We=[Fe,Ue],Ve=Object(r["h"])(" person_add "),Ke=Object(r["g"])("p",null,"加入好友",-1),_e=[Ve,Ke],He=Object(r["h"])(" group_add "),Qe=Object(r["g"])("p",null,"好友邀請",-1),Te=[He,Qe],ze=Object(r["h"])("manage_accounts "),Je=Object(r["g"])("p",null,"關於自己",-1),Be=[ze,Je];function Ge(e,t,n,a,c,u){var s,o;return Object(r["u"])(),Object(r["f"])("aside",Pe,[Object(r["g"])("div",qe,[Object(r["g"])("span",{class:Object(r["o"])(["material-icons",{active:"friendList"==a.activeEl}]),onClick:t[0]||(t[0]=function(e){return a.handleClick("friendList"),a.addActive("friendList")})},Me,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",["chatrooms"==a.activeEl?"active":"",null!==(s=a.document)&&void 0!==s&&s.messageIsRead?"":"new"]]),onClick:t[1]||(t[1]=function(e){a.handleClick("chatrooms"),a.addActive("chatrooms")})},We,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",{active:"addFriends"==a.activeEl}]),onClick:t[2]||(t[2]=function(e){a.handleClick("addFriends"),a.addActive("addFriends")})},_e,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",["friendRequests"==a.activeEl?"active":"",null!==(o=a.document)&&void 0!==o&&o.requestIsRead?"":"new"]]),onClick:t[3]||(t[3]=function(e){a.handleClick("friendRequests"),a.addActive("friendRequests")})},Te,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",{active:"aboutMe"==a.activeEl}]),onClick:t[4]||(t[4]=function(e){a.handleClick("aboutMe"),a.addActive("aboutMe")})},Be,2)])])}var Xe={setup:function(){var e=Object(k["l"])(),t=Object(d["d"])(),n=H(),r=n.user,a=r.value.uid,c=Ae("users",a),u=c.document,s=function(e){t.push({name:"Chatroom",params:{id:e}})},o=function(t){if(e.value=t,"chatrooms"===t){var n=T("users",a),r=n.updateDoc;r({messageIsRead:!0})}if("friendRequests"===t){var c=T("users",a),u=c.updateDoc;u({requestIsRead:!0})}};return{handleClick:s,activeEl:e,addActive:o,document:u}}};n("25a2");const Ye=o()(Xe,[["render",Ge]]);var Ze=Ye,$e={class:"frineds"},et={key:0,class:"friend-list"},tt={key:1,class:"addFriends"},nt={key:2,class:"friend-requests"},rt={key:3,class:"about-me"};function at(e,t,n,a,c,u){var s=Object(r["A"])("FriendList"),o=Object(r["A"])("AddFriendList"),i=Object(r["A"])("FriendRequestList"),l=Object(r["A"])("AboutMe"),d=Object(r["A"])("ChatroomList");return Object(r["u"])(),Object(r["f"])("section",$e,["friendList"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",et,[Object(r["i"])(s)])):Object(r["e"])("",!0),"addFriends"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",tt,[Object(r["i"])(o)])):Object(r["e"])("",!0),"friendRequests"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",nt,[Object(r["i"])(i)])):Object(r["e"])("",!0),"aboutMe"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",rt,[Object(r["i"])(l)])):Object(r["e"])("",!0),Object(r["i"])(d)])}n("b0c0");var ct=Object(r["g"])("div",{class:"category"},"我的資料",-1),ut={key:0,class:"user-infos"},st={class:"user-info display-name"},ot=Object(r["h"])(" 顯示名稱 "),it=Object(r["g"])("span",{class:"material-icons"},"edit",-1),lt={class:"user-info status-message"},dt=Object(r["h"])(" 狀態消息 "),bt=Object(r["g"])("span",{class:"material-icons"}," edit ",-1),ft={class:"user-info user-id"},pt=Object(r["h"])(" 用戶ID "),vt={class:"user-info email"},mt=Object(r["h"])(" 電子郵件帳號 "),Ot=Object(r["g"])("div",{class:"user-info developer"},[Object(r["h"])(" 此程式開發者ID（歡迎加我好友） "),Object(r["g"])("p",null,"pvzcHUVscLOjoAOK0eQQxHx3qOV2")],-1),jt={key:1,class:"reminder"};function ht(e,t,n,a,c,u){var s=Object(r["A"])("Loader");return Object(r["u"])(),Object(r["f"])(r["a"],null,[ct,a.userInfo?(Object(r["u"])(),Object(r["f"])("div",ut,[Object(r["g"])("div",st,[ot,Object(r["g"])("p",{onClick:t[0]||(t[0]=function(e){return a.showNameInput=!a.showNameInput,a.showStatusInput=!1})},[Object(r["h"])(Object(r["C"])(a.userInfo.displayName)+" ",1),it]),Object(r["g"])("form",{onSubmit:t[2]||(t[2]=Object(r["K"])((function(){return a.handleSubmitName&&a.handleSubmitName.apply(a,arguments)}),["prevent"]))},[a.showNameInput?Object(r["I"])((Object(r["u"])(),Object(r["f"])("input",{key:0,type:"text","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.name=e}),placeholder:"請輸入新名稱(十字以內)",maxlength:"10"},null,512)),[[r["E"],a.name]]):Object(r["e"])("",!0)],32)]),Object(r["g"])("div",lt,[dt,Object(r["g"])("p",{onClick:t[3]||(t[3]=function(e){return a.showStatusInput=!a.showStatusInput,a.showNameInput=!1})},[Object(r["h"])(Object(r["C"])(a.userInfo.statusMessage)+" ",1),bt]),Object(r["g"])("form",{onSubmit:t[5]||(t[5]=Object(r["K"])((function(){return a.handleSubmitStatus&&a.handleSubmitStatus.apply(a,arguments)}),["prevent"]))},[a.showStatusInput?Object(r["I"])((Object(r["u"])(),Object(r["f"])("input",{key:0,type:"text","onUpdate:modelValue":t[4]||(t[4]=function(e){return a.statusMessage=e}),placeholder:"請輸入新狀態(二十字以內)",maxlength:"20"},null,512)),[[r["E"],a.statusMessage]]):Object(r["e"])("",!0)],32)]),Object(r["g"])("div",ft,[pt,Object(r["g"])("p",null,Object(r["C"])(a.user.uid),1)]),Object(r["g"])("div",vt,[mt,Object(r["g"])("p",null,Object(r["C"])(a.user.email),1)]),Ot])):(Object(r["u"])(),Object(r["f"])("div",jt,[Object(r["i"])(s)]))],64)}n("d3b7"),n("159b");var gt={class:"loader"};function wt(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("div",gt)}var yt={};n("320b");const xt=o()(yt,[["render",wt]]);var kt=xt,Rt={components:{Loader:kt},setup:function(){var e=H(),t=e.user,n=Ae("users",t.value.uid),r=n.document,a=T("users",t.value.uid),c=a.updateDoc,u=Object(k["l"])(!1),s=Object(k["l"])(!1),o=[],i=[],l=[],d=t.value.uid,b=Object(k["l"])(""),f=Object(k["l"])(""),p=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.collection("users").doc(t.value.uid).collection("friendList").get().then((function(e){return e.forEach((function(e){return o.push(e.data().userId)}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.collection("users").doc(t.value.uid).collection("chatrooms").get().then((function(e){return e.forEach((function(e){return i.push([e.data().friendId,e.data().chatroomId])}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.collection("users").doc(t.value.uid).collection("sentRequests").get().then((function(e){return e.forEach((function(e){return l.push(e.data().userId)}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(b.value){e.next=3;break}return u.value=!1,e.abrupt("return");case 3:return c({displayName:b.value}),u.value=!1,e.next=7,p();case 7:return o.forEach((function(e){var n=oe("users",e,"friendList"),r=n.updateDoc;r(t.value.uid,{displayName:b.value})})),e.next=10,v();case 10:return i.forEach((function(e){var t=oe("users",e[0],"chatrooms"),n=t.updateDoc;n(e[1],{displayName:b.value})})),e.next=13,m();case 13:l.forEach((function(e){var n=oe("users",e,"friendRequests"),r=n.updateDoc;r(t.value.uid,{displayName:b.value})})),b.value="",o.length=0,i.length=0,l.length=0;case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(f.value){e.next=3;break}return s.value=!1,e.abrupt("return");case 3:return c({statusMessage:f.value}),s.value=!1,e.next=7,p();case 7:o.forEach((function(e){var t=oe("users",e,"friendList"),n=t.updateDoc;n(d,{statusMessage:f.value})})),f.value="",o.length=0;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{user:t,userInfo:r,name:b,statusMessage:f,showNameInput:u,showStatusInput:s,handleSubmitName:O,handleSubmitStatus:j}}};n("4fa4");const It=o()(Rt,[["render",ht]]);var Ct=It,At={key:0,class:"chatrooms"},Lt=Object(r["g"])("div",{class:"category"},"聊天室",-1),Dt={key:0},St=["onClick"],Pt={class:"infos"},qt={class:"display-name"},Nt={class:"dialog"},Et={class:"lastInteractTime"},Mt={key:1,class:"reminder"},Ft={key:2,class:"reminder"};function Ut(e,t,n,a,c,u){var s,o,i=Object(r["A"])("Loader");return"friendList"!==a.routeParams&&"addFriends"!==a.routeParams&&"friendRequests"!==a.routeParams&&"aboutMe"!==a.routeParams?(Object(r["u"])(),Object(r["f"])("div",At,[Lt,(null===(s=a.formattedChatroomList)||void 0===s?void 0:s.length)>0?(Object(r["u"])(),Object(r["f"])("div",Dt,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.formattedChatroomList,(function(e){return Object(r["u"])(),Object(r["f"])("div",{key:e.chatroomId},[e?(Object(r["u"])(),Object(r["f"])("div",{key:0,class:Object(r["o"])(["friend",{active:e.isActive}]),onClick:function(t){return a.handleClick(null===e||void 0===e?void 0:e.chatroomId)}},[Object(r["g"])("div",Pt,[Object(r["g"])("p",qt,Object(r["C"])(e.displayName),1),Object(r["g"])("p",Nt,Object(r["C"])(e.dialog),1)]),Object(r["g"])("p",Et,Object(r["C"])(e.lastInteractAt),1),Object(r["g"])("p",{class:Object(r["o"])({isRead:!e.isRead})},Object(r["C"])(e.isRead?"":"新訊息"),3)],10,St)):Object(r["e"])("",!0)])})),128))])):0===(null===(o=a.formattedChatroomList)||void 0===o?void 0:o.length)?(Object(r["u"])(),Object(r["f"])("div",Mt," 請點選好友，開啟專屬聊天室 ")):(Object(r["u"])(),Object(r["f"])("div",Ft,[Object(r["i"])(i)]))])):Object(r["e"])("",!0)}n("d81d");var Wt=n("5c40"),Vt=n("2909"),Kt=function(e,t,n,a,c){var u,s,o=Object(r["x"])(null),i=Object(r["x"])(null),l=N.collection(e).doc(t).collection(n);a&&(l=(u=l).orderBy.apply(u,Object(Vt["a"])(a)));c&&(l=(s=l).where.apply(s,Object(Vt["a"])(c)));var d=l.onSnapshot(function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=[],t.docs.forEach(function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a?t.data()[a[0]]&&n.push(Object(Ie["a"])(Object(Ie["a"])({},t.data()),{},{id:t.id})):n.push(Object(Ie["a"])(Object(Ie["a"])({},t.data()),{},{id:t.id}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.value=n,i.value=null;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){console.log(e.message),o.value=null,i.value="could not fetch dada"}));return Object(r["G"])((function(e){e((function(){return d()}))})),{documents:o,error:i}},_t=Kt,Ht=n("efaa"),Qt=n("4602"),Tt={components:{Loader:kt},setup:function(){var e=Object(d["d"])(),t=Object(d["c"])(),n=Object(k["l"])(t.params.id),r=H(),a=r.user,c=[],u=a.value.uid,s=T("users",u),o=s.updateDoc,i=_t("users",u,"chatrooms",["chatroomOrder","desc"],["isDisplay","==",!0]),l=i.documents,b=Object(k["c"])((function(){if(l.value)return l.value.map((function(e){if(e.lastInteractAt){var t=Object(Ht["a"])(Object(Qt["a"])(e.lastInteractAt),{hour:"numeric",minute:"numeric"});return o({messageIsRead:!0}),Object(Ie["a"])(Object(Ie["a"])({},e),{},{lastInteractAt:t})}var n=Object(Ht["a"])(Object(Qt["a"])((new Date).getTime()/1e3),{hour:"numeric",minute:"numeric"});return c.length=0,c.push(n),o({messageIsRead:!0}),Object(Ie["a"])(Object(Ie["a"])({},e),{},{lastInteractAt:c[0]})}))}));Object(Wt["R"])((function(){n.value=t.params.id}));var f=function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(r){var a,c,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,null===(a=N.collection("users").doc(u).collection("chatrooms").where("isActive","==",!0))||void 0===a?void 0:a.get().then((function(e){return e.forEach((function(e){console.log("hi"),e.ref.update({isActive:!1})}))}));case 2:return c=oe("users",u,"chatrooms"),s=c.updateDoc,t.next=5,e.push({name:"Chatroom",params:{id:r}});case 5:return t.next=7,s(n.value,{isActive:!0});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{handleClick:f,routeParams:n,formattedChatroomList:b}}};n("601a");const zt=o()(Tt,[["render",Ut]]);var Jt=zt,Bt=Object(r["g"])("p",{class:"category"},"自己",-1),Gt={key:0,class:"friend"},Xt={class:"infos"},Yt={class:"display-name"},Zt={class:"statusMessage"},$t=Object(r["g"])("p",{class:"category"},"好友列表",-1),en={key:1},tn=["onClick"],nn={class:"infos"},rn={class:"display-name"},an={class:"statusMessage"},cn={key:2,class:"reminder"},un={key:3,class:"reminder"};function sn(e,t,n,a,c,u){var s,o,i=Object(r["A"])("Loader");return Object(r["u"])(),Object(r["f"])(r["a"],null,[Bt,a.userInfo?(Object(r["u"])(),Object(r["f"])("div",Gt,[Object(r["g"])("div",Xt,[Object(r["g"])("p",Yt,Object(r["C"])(a.userInfo.displayName),1),Object(r["g"])("p",Zt,Object(r["C"])(a.userInfo.statusMessage),1)])])):Object(r["e"])("",!0),$t,(null===(s=a.friendList)||void 0===s?void 0:s.length)>0?(Object(r["u"])(),Object(r["f"])("div",en,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.friendList,(function(e){return Object(r["u"])(),Object(r["f"])("div",{class:"friend",key:e.chatroomId,onClick:function(t){return a.handleClick(e.chatroomId)}},[Object(r["g"])("div",nn,[Object(r["g"])("p",rn,Object(r["C"])(e.displayName),1),Object(r["g"])("p",an,Object(r["C"])(e.statusMessage),1)])],8,tn)})),128))])):0===(null===(o=a.friendList)||void 0===o?void 0:o.length)?(Object(r["u"])(),Object(r["f"])("div",cn,"請先新增好友")):(Object(r["u"])(),Object(r["f"])("div",un,[Object(r["i"])(i)]))],64)}var on={components:{Loader:kt},setup:function(){var e=Object(d["d"])(),t=H(),n=t.user,r=n.value.displayName,a=Ae("users",n.value.uid),c=a.document,u=_t("users",n.value.uid,"friendList"),s=u.documents,o=u.error,i=(n.value.uid,function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(r){var a,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.value){t.next=2;break}return t.abrupt("return");case 2:return e.push({name:"Chatroom",params:{id:r}}),a=oe("users",n.value.uid,"chatrooms"),c=a.updateDoc,u=oe("users",n.value.uid,"chatrooms").updateDoc,t.next=7,u(r,{isDisplay:!0});case 7:return t.next=9,c(r,{isActive:!0});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());return{handleClick:i,userDisplayName:r,userInfo:c,friendList:s,error:o,Loader:kt}}};n("d450");const ln=o()(on,[["render",sn]]);var dn=ln,bn=Object(r["g"])("div",{class:"category"},"加入好友",-1),fn=Object(r["g"])("span",{class:"material-icons"}," search ",-1),pn={class:"userInfo"},vn={key:0,class:"display-name"},mn={key:1,class:"error"};function On(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])(r["a"],null,[bn,Object(r["g"])("form",{onSubmit:t[1]||(t[1]=Object(r["K"])((function(e){return a.handleSubmit(a.userId)}),["prevent"]))},[Object(r["I"])(Object(r["g"])("input",{placeholder:"請輸入用戶ID","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.userId=e})},null,512),[[r["E"],a.userId]]),fn],32),Object(r["g"])("div",pn,[a.document?(Object(r["u"])(),Object(r["f"])("div",vn,Object(r["C"])(a.document.displayName),1)):Object(r["e"])("",!0),a.error?(Object(r["u"])(),Object(r["f"])("div",mn,Object(r["C"])(a.error),1)):Object(r["e"])("",!0),a.buttonText?(Object(r["u"])(),Object(r["f"])("button",{key:2,onClick:t[2]||(t[2]=function(e){return a.handleClick(a.userId)})},Object(r["C"])(a.buttonText),1)):Object(r["e"])("",!0)])],64)}n("498a"),n("caad");var jn={setup:function(){var e=Object(k["l"])(),t=Object(k["l"])(),n=Object(k["l"])(),r=Object(k["l"])(),a=[],c=[],u=[],s=H(),o=s.user,i=function(){var a=Object(D["a"])(regeneratorRuntime.mark((function a(s){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s){a.next=2;break}return a.abrupt("return");case 2:return s=s.trim(),a.next=5,N.collection("users").doc(o.value.uid).collection("sentRequests").get().then((function(e){return e.forEach((function(e){return u.push(e.data().userId)}))}));case 5:return a.next=7,N.collection("users").doc(o.value.uid).collection("friendList").get().then((function(e){e.forEach((function(e){c.push(e.data().userId)}))}));case 7:return a.next=9,N.collection("users").doc(s).get().then((function(e){return e}));case 9:if(i=a.sent,!u.includes(s)){a.next=17;break}return n.value=i.data(),r.value="您已寄出過邀請囉！請等待對方回覆",e.value="",u.length=0,c.length=0,a.abrupt("return");case 17:if(!c.includes(s)){a.next=24;break}return n.value=i.data(),r.value="你們已是好友囉！",e.value="",u.length=0,c.length=0,a.abrupt("return");case 24:if(s!==o.value.uid){a.next=31;break}return n.value=i.data(),r.value="這是您自己哦！",e.value="",u.length=0,c.length=0,a.abrupt("return");case 31:i.exists?(r.value="",t.value="加入",n.value=i.data(),u.length=0,c.length=0):(r.value="Oops...查無此ID",n.value="",t.value="",e.value="",u.length=0,c.length=0);case 32:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),l=function(){var r=Object(D["a"])(regeneratorRuntime.mark((function r(c){var u,s,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return u={displayName:a[0].displayName,userId:a[0].userId},s=T("users",c),i=s.updateDoc,r.next=4,oe("users",c,"friendRequests").addDocWithId(o.value.uid,u);case 4:return r.next=6,oe("users",o.value.uid,"sentRequests").addDocWithId(c,{userId:c});case 6:return r.next=8,i({requestIsRead:!1});case 8:e.value="",n.value="",t.value="",a.length=0;case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return Object(Wt["R"])(Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o.value){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,N.collection("users").doc(o.value.uid).get().then((function(e){a.push(e.data())}));case 4:case"end":return e.stop()}}),e)})))),{userId:e,handleSubmit:i,document:n,error:r,buttonText:t,handleClick:l}}};n("a5ac");const hn=o()(jn,[["render",On]]);var gn=hn,wn=Object(r["g"])("p",{class:"category"},"好友邀請",-1),yn={key:0},xn={class:"display-name"},kn={class:"buttons"},Rn=["onClick"],In=["onClick"],Cn={key:1,class:"reminder"},An={key:2,class:"reminder"};function Ln(e,t,n,a,c,u){var s,o,i=Object(r["A"])("Loader");return Object(r["u"])(),Object(r["f"])(r["a"],null,[wn,"friendList"!==a.routeParams&&"addFriends"!==a.routeParams&&"chatrooms"!==a.routeParams&&"aboutMe"!==a.routeParams&&(null===(s=a.requests)||void 0===s?void 0:s.length)>0?(Object(r["u"])(),Object(r["f"])("div",yn,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.requests,(function(e){return Object(r["u"])(),Object(r["f"])("div",{class:"request",key:e.userId},[Object(r["g"])("p",xn,Object(r["C"])(e.displayName),1),Object(r["g"])("div",kn,[Object(r["g"])("button",{class:"delete",onClick:function(t){return a.handleDelete(e.userId)}}," 刪除 ",8,Rn),Object(r["g"])("button",{class:"accept",onClick:function(t){return a.handleAccept(e.userId,e.displayName)}}," 接受 ",8,In)])])})),128))])):0===(null===(o=a.requests)||void 0===o?void 0:o.length)?(Object(r["u"])(),Object(r["f"])("div",Cn," 目前尚無好友邀請 ")):(Object(r["u"])(),Object(r["f"])("div",An,[Object(r["i"])(i)]))],64)}var Dn={components:{Loader:kt},setup:function(){var e=n("4487"),t=Object(d["c"])(),r=Object(k["l"])(t.params.id),a=[],c=[],u=H(),s=u.user,o=s.value.uid,i=T("users",o),l=i.updateDoc,b=_t("users",s.value.uid,"friendRequests"),f=b.documents,p=Object(k["c"])((function(){if(f.value)return l({requestIsRead:!0}),f.value}));Object(Wt["Q"])(t,Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.value=t.params.id;case 1:case"end":return e.stop()}}),e)}))));var v=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:oe("users",s.value.uid,"friendRequests").deleteDoc(t),oe("users",t,"sentRequests").deleteDoc(s.value.uid);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(n){var r,u,o,i,l,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.generate(20);case 2:return r=t.sent,t.next=5,N.collection("users").doc(s.value.uid).get().then((function(e){a.push(e.data())}));case 5:return t.next=7,N.collection("users").doc(n).get().then((function(e){c.push(e.data())}));case 7:return u={chatroomId:r,usersId:[n,s.value.uid]},ue("chatrooms").addDocWithId(r,u),o={chatroomId:r,displayName:c[0].displayName,friendId:c[0].userId,lastInteractAt:E(),chatroomOrder:E(),lastRead:E(),isActive:!1,isDisplay:!1,isRead:!0},i={chatroomId:r,userId:c[0].userId,displayName:c[0].displayName,statusMessage:c[0].statusMessage},l={chatroomId:r,lastInteractAt:E(),chatroomOrder:E(),lastRead:E(),displayName:a[0].displayName,friendId:a[0].userId,isDisplay:!1,isRead:!0,isActive:!1},d={chatroomId:r,userId:a[0].userId,displayName:a[0].displayName,statusMessage:a[0].statusMessage},t.next=15,oe("users",a[0].userId,"chatrooms").addDocWithId(r,o);case 15:return t.next=17,oe("users",c[0].userId,"chatrooms").addDocWithId(r,l);case 17:return t.next=19,oe("users",a[0].userId,"friendList").addDocWithId(c[0].userId,i);case 19:return t.next=21,oe("users",c[0].userId,"friendList").addDocWithId(a[0].userId,d);case 21:return t.next=23,oe("users",a[0].userId,"friendRequests").deleteDoc(c[0].userId);case 23:return t.next=25,oe("users",c[0].userId,"sentRequests").deleteDoc(a[0].userId);case 25:c.length=0,a.length=0;case 27:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{routeParams:r,requests:p,handleDelete:v,handleAccept:m}}};n("37b6");const Sn=o()(Dn,[["render",Ln]]);var Pn=Sn,qn={key:0,class:"reminder"},Nn=Object(r["g"])("p",null,[Object(r["h"])("點選好友"),Object(r["g"])("br"),Object(r["h"])("進入專屬聊天室")],-1),En=[Nn],Mn={key:1,class:"reminder"},Fn=Object(r["g"])("p",null,[Object(r["h"])("輸入用戶ID"),Object(r["g"])("br"),Object(r["h"])("並加入好友")],-1),Un=[Fn],Wn={key:2,class:"reminder"},Vn=Object(r["g"])("p",null,"接受/刪除好友邀請",-1),Kn=[Vn],_n={key:3,class:"reminder"},Hn=Object(r["g"])("p",null,"個人資料設定",-1),Qn=[Hn],Tn={key:4,class:"reminder"},zn=Object(r["g"])("p",null,[Object(r["h"])("點選左方聊天室 "),Object(r["g"])("br"),Object(r["h"])("方可開始聊天")],-1),Jn=[zn],Bn={key:5,class:"chat-window"};function Gn(e,t,n,a,c,u){var s=Object(r["A"])("displayName"),o=Object(r["A"])("messages"),i=Object(r["A"])("newChatForm");return Object(r["u"])(),Object(r["f"])("main",{class:Object(r["o"])([{showSingleChatroom:a.showSingleChatroom},"single-chatroom"])},["friendList"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",qn,En)):"addFriends"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Mn,Un)):"friendRequests"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Wn,Kn)):"aboutMe"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",_n,Qn)):"chatrooms"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Tn,Jn)):(Object(r["u"])(),Object(r["f"])("div",Bn,[Object(r["i"])(s),Object(r["i"])(o),Object(r["i"])(i)]))],2)}var Xn={key:0,class:"displayName"},Yn={key:1};function Zn(e,t,n,a,c,u){return a.formattedChatroomList?(Object(r["u"])(),Object(r["f"])("div",Xn,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.formattedChatroomList,(function(e){return Object(r["u"])(),Object(r["f"])("div",{key:e.chatroomId},[Object(r["g"])("p",null,Object(r["C"])(e.displayName),1)])})),128))])):(Object(r["u"])(),Object(r["f"])("div",Yn))}var $n={setup:function(){var e=H(),t=e.user,n=_t("users",t.value.uid,"chatrooms","",["isActive","==",!0]).documents,r=Object(k["c"])((function(){var e;if((null===(e=n.value)||void 0===e?void 0:e.length)>0)return n.value.map((function(e){return e}))}));return{formattedChatroomList:r}}};n("45fc");const er=o()($n,[["render",Zn]]);var tr=er,nr={key:0,class:"messages",ref:"messages"},rr={class:"message-info"},ar={class:"is-read"},cr={class:"created-at"},ur={class:"content"};function sr(e,t,n,a,c,u){return a.routeParams?(Object(r["u"])(),Object(r["f"])("div",nr,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.formattedMessages(),(function(e){var t,n;return Object(r["u"])(),Object(r["f"])("div",{class:Object(r["o"])(["message",{friendMessage:e.userId!==(null===(t=a.user)||void 0===t?void 0:t.uid),myMessage:e.userId===(null===(n=a.user)||void 0===n?void 0:n.uid)}]),key:e.id},[Object(r["g"])("div",rr,[Object(r["g"])("p",ar,Object(r["C"])(e.isRead?"已讀":""),1),Object(r["g"])("p",cr,Object(r["C"])(e.createdAt),1)]),Object(r["g"])("p",ur,Object(r["C"])(e.message),1)],2)})),128))],512)):Object(r["e"])("",!0)}var or={setup:function(){var e=H(),t=e.user,n=Object(d["c"])(),r=Object(k["l"])(""),a=Object(k["l"])(null),c=Object(k["l"])(""),u=[],s=Object(k["l"])(t.value.uid),o=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.collection("users").doc(t.value.uid).collection("chatrooms").doc(n.params.id).get().then((function(e){return u.push({lastRead:e.data().lastRead.seconds,lastInteractAt:e.data().lastInteractAt.seconds})}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){if(c.value)return c.value.map((function(e){var t=Object(Ht["a"])(Object(Qt["a"])(e.createdAt),{hour:"numeric",minute:"numeric"});return N.collection("chatrooms").doc(r.value).collection("messages").where("isRead","==",!1).where("userId","!=",s.value).get().then((function(e){e.forEach((function(e){e.ref.update({isRead:!0})}))})),Object(Ie["a"])(Object(Ie["a"])({},e),{},{createdAt:t})}))};return Object(Wt["R"])(Object(D["a"])(regeneratorRuntime.mark((function e(){var a,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.value){e.next=2;break}return e.abrupt("return");case 2:if("friendList"!==n.params.id&&"addFriends"!==n.params.id&&"friendRequests"!==n.params.id&&"chatrooms"!==n.params.id&&"aboutMe"!==n.params.id&&n.params.id){e.next=4;break}return e.abrupt("return");case 4:return r.value=n.params.id,c=_t("chatrooms",r.value,"messages",["createdAt"]).documents,a=oe("users",t.value.uid,"chatrooms"),u=a.updateDoc,e.next=9,N.collection("chatrooms").doc(r.value).collection("messages").where("isRead","==",!1).where("userId","!=",s.value).get().then((function(e){e.forEach((function(e){e.ref.update({isRead:!0})}))}));case 9:return e.next=11,o();case 11:return e.next=13,u(r.value,{isRead:!0,lastRead:E()});case 13:case"end":return e.stop()}}),e)})))),Object(Wt["B"])((function(){a.value&&(a.value.scrollTop=a.value.scrollHeight)})),{user:t,formattedMessages:i,routeParams:r,messages:a}}};n("3a40");const ir=o()(or,[["render",sr]]);var lr=ir,dr={class:"chat-form"};function br(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("form",dr,[Object(r["I"])(Object(r["g"])("textarea",{placeholder:"輸入訊息","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.message=e}),onKeypress:t[1]||(t[1]=Object(r["J"])(Object(r["K"])((function(e){return a.width>768?a.handleSubmit():a.handleLineFeed()}),["prevent"]),["enter"]))},null,544),[[r["E"],a.message]]),Object(r["g"])("span",{class:"material-icons",onClick:t[2]||(t[2]=function(){return a.handleSubmit&&a.handleSubmit.apply(a,arguments)})}," send ")])}var fr=function(){let e=Object(r["x"])(window.innerWidth);const t=()=>e.value=window.innerWidth;Object(r["s"])(()=>window.addEventListener("resize",t)),Object(r["t"])(()=>window.removeEventListener("resize",t));const n=Object(r["b"])(()=>e.value<550?"xs":e.value>=550&&e.value<1200?"md":e.value>=1200?"lg":null),a=Object(r["b"])(()=>e.value);return{width:a,type:n}},pr={setup:function(){var e=H(),t=e.user,n=Object(k["l"])(""),r=Object(d["c"])(),a=Object(k["l"])(!1),c=Object(k["l"])(),u=Object(k["l"])(t.value.uid),s=[],o=fr(),i=o.width,l=Object(k["l"])(""),b=oe("chatrooms",r.params.id,"messages"),f=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.collection("users").doc(c.value).collection("chatrooms").doc(r.params.id).get().then((function(e){return s.push({lastRead:e.data().lastRead.seconds,lastInteractAt:e.data().lastInteractAt.seconds,isActive:e.data().isActive})}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(Wt["R"])(Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r.params.id){e.next=6;break}return e.next=3,oe("chatrooms",r.params.id,"messages");case 3:b=e.sent,a.value=!0,console.log(a.value);case 6:case"end":return e.stop()}}),e)}))));var p=function(){console.log("換行"),n.value=n.value+"\n"},v=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){var o,i,l,d,p,v,m,O;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("hi"),e.next=3,N.collection("chatrooms").doc(r.params.id).get().then((function(e){return e.data().usersId}));case 3:return o=e.sent,o[0]===t.value.uid?c.value=o[1]:c.value=o[0],e.next=7,N.collection("users").doc(u.value).collection("chatrooms").doc(r.params.id);case 7:return i=e.sent,e.next=10,N.collection("users").doc(c.value).collection("chatrooms").doc(r.params.id);case 10:if(l=e.sent,d={userId:u.value,isRead:!1,message:n.value,createdAt:E()},n.value="",d.message){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,b.addDoc(d);case 17:return e.next=19,i.update(Object(Ie["a"])({dialog:d.message,lastInteractAt:E(),isDisplay:!0},a.value&&{chatroomOrder:E()}));case 19:return e.next=21,l.update(Object(Ie["a"])({dialog:d.message,lastInteractAt:d.createdAt,isDisplay:!0},a.value&&{chatroomOrder:d.createdAt}));case 21:return a.value=!1,p=oe("users",c.value,"chatrooms"),v=p.updateDoc,e.next=25,f();case 25:return e.next=27,v(r.params.id,Object(Ie["a"])(Object(Ie["a"])({},!s[0].isActive&&{isRead:s[0].lastRead>s[0].lastInteractAt}),{},{lastRead:E()}));case 27:return m=T("users",c.value),O=m.updateDoc,e.next=30,O(Object(Ie["a"])({},!s[0].isActive&&{messageIsRead:!1}));case 30:s.length=0;case 31:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{message:n,handleSubmit:v,width:i,handleLineFeed:p,placeholder:l}}};n("8e47");const vr=o()(pr,[["render",br]]);var mr=vr,Or={components:{displayName:tr,messages:lr,newChatForm:mr},setup:function(){var e=Object(k["l"])(""),t=Object(d["c"])(),n=Object(k["l"])(!1),r=fr(),a=r.width,c=["friendList","chatrooms","addFriends","friendRequests","aboutMe"];return Object(Wt["R"])((function(){e.value=t.params.id,a.value<768?c.includes(e.value)?n.value=!1:n.value=!0:n.value=!1})),{routeParams:e,showSingleChatroom:n}}};n("d434");const jr=o()(Or,[["render",Gn]]);var hr=jr,gr={components:{SingleChatroom:hr,FriendList:dn,ChatroomList:Jt,AddFriendList:gn,FriendRequestList:Pn,AboutMe:Ct},setup:function(){var e=Object(d["c"])(),t=Object(k["l"])(e.params.id),n=H(),r=n.user;r.value.uid;Object(Wt["Q"])(e,Object(D["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a(t.value),t.value=e.params.id;case 2:case"end":return n.stop()}}),n)}))));var a=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{routeParams:t}}};n("b73d");const wr=o()(gr,[["render",at]]);var yr=wr,xr={props:["id"],components:{Navbar:Se,Sidebar:Ze,Friends:yr,SingleChatroom:hr},setup:function(){}};n("852f");const kr=o()(xr,[["render",me]]);var Rr,Ir=kr,Cr=function(e,t,n){var r=q.currentUser;r?n():n({name:"Welcome"})},Ar=function(e,t,n){var r=q.currentUser;r?n({name:"Chatroom",params:{id:"chatrooms"}}):n()},Lr=[{path:"/",name:"Welcome",component:pe,beforeEnter:Ar},{path:"/chatroom/:id",name:"Chatroom",component:Ir,beforeEnter:Cr,props:!0}],Dr=Object(d["a"])({history:Object(d["b"])("/"),routes:Lr}),Sr=Dr;n("845f");q.onAuthStateChanged((function(){Rr||(Rr=Object(r["c"])(l).use(Sr).mount("#app"))}))},6:function(e,t){},"601a":function(e,t,n){"use strict";n("fc04")},6308:function(e,t,n){},"6f6b":function(e,t,n){},7:function(e,t){},"79fc":function(e,t,n){},8:function(e,t){},8285:function(e,t,n){},"845f":function(e,t,n){},"852f":function(e,t,n){"use strict";n("6f6b")},"8de3":function(e,t,n){},"8e47":function(e,t,n){"use strict";n("79fc")},9:function(e,t){},"9d04":function(e,t,n){},"9d68":function(e,t,n){"use strict";n("d21f")},a05a:function(e,t,n){},a5ac:function(e,t,n){"use strict";n("1e68")},b73d:function(e,t,n){"use strict";n("9d04")},c6c1:function(e,t,n){},c753:function(e,t,n){},cf05:function(e,t,n){e.exports=n.p+"img/logo.3ae9eaab.png"},d21f:function(e,t,n){},d434:function(e,t,n){"use strict";n("4c3d")},d450:function(e,t,n){"use strict";n("8285")},daf7:function(e,t,n){},e3d1:function(e,t,n){"use strict";n("daf7")},eec7:function(e,t,n){"use strict";n("3e42")},fc04:function(e,t,n){}});
//# sourceMappingURL=app.f1288918.js.map