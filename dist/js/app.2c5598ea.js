(function(e){function t(t){for(var r,u,s=t[0],o=t[1],i=t[2],d=0,b=[];d<s.length;d++)u=s[d],Object.prototype.hasOwnProperty.call(a,u)&&a[u]&&b.push(a[u][0]),a[u]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);l&&l(t);while(b.length)b.shift()();return c.push.apply(c,i||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,s=1;s<n.length;s++){var o=n[s];0!==a[o]&&(r=!1)}r&&(c.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},a={app:0},c=[];function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var i=0;i<s.length;i++)t(s[i]);var l=o;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"026e":function(e,t,n){},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},"19f5":function(e,t,n){"use strict";n("2bee")},"1e68":function(e,t,n){},2:function(e,t){},"25a2":function(e,t,n){"use strict";n("a05a")},"2bee":function(e,t,n){},"2cbe":function(e,t,n){},3:function(e,t){},"30c4":function(e,t,n){"use strict";n("026e")},"320b":function(e,t,n){"use strict";n("4df4")},"3a40":function(e,t,n){"use strict";n("6308")},"3e42":function(e,t,n){},4:function(e,t){},"413f":function(e,t,n){},"45fc":function(e,t,n){"use strict";n("413f")},"4c3d":function(e,t,n){},"4df4":function(e,t,n){},"4fa4":function(e,t,n){"use strict";n("c753")},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function a(e,t,n,a,c,u){var s=Object(r["A"])("router-view"),o=Object(r["A"])("vue100vh");return Object(r["u"])(),Object(r["d"])(o,{class:"container",css:{height:"100rvh"}},{default:Object(r["H"])((function(){return[Object(r["i"])(s)]})),_:1})}var c=n("1859"),u={components:{vue100vh:c["a"]},setup:function(){}},s=(n("e3d1"),n("6b0d")),o=n.n(s);const i=o()(u,[["render",a]]);var l=i,d=n("6c02"),b={"welcom-form":""},f=Object(r["g"])("h1",null,"馬鈴薯聊天室",-1),p={class:"welcome container"},v={key:0,class:"login-form"},m=Object(r["g"])("h3",null,"登入帳號",-1),O=Object(r["h"])("還沒有帳號？ "),j={key:1,class:"signup-form"},h=Object(r["g"])("h3",null,"註冊帳號",-1),g=Object(r["h"])("已經有帳號了？ ");function w(e,t,n,a,c,u){var s=Object(r["A"])("loginForm"),o=Object(r["A"])("SignupForm");return Object(r["u"])(),Object(r["f"])("div",b,[f,Object(r["g"])("div",p,[a.showLogin?(Object(r["u"])(),Object(r["f"])("div",v,[m,Object(r["i"])(s,{onLogin:a.enterChatroom},null,8,["onLogin"]),Object(r["g"])("p",null,[O,Object(r["g"])("span",{onClick:t[0]||(t[0]=function(e){return a.showLogin=!1})},"註冊帳號")])])):(Object(r["u"])(),Object(r["f"])("div",j,[h,Object(r["i"])(o),Object(r["g"])("p",null,[g,Object(r["g"])("span",{onClick:t[1]||(t[1]=function(e){return a.showLogin=!0})},"登入帳號")])]))])])}var y=n("a1e9"),x={class:"inputs"},k={class:"error"},R={key:0},I={key:1,disabled:""};function C(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("form",{onSubmit:t[2]||(t[2]=Object(r["K"])((function(){return a.handleSubmit&&a.handleSubmit.apply(a,arguments)}),["prevent"]))},[Object(r["g"])("div",x,[Object(r["I"])(Object(r["g"])("input",{type:"email",required:"",placeholder:"電子郵件帳號","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.email=e}),autocomplete:"off"},null,512),[[r["E"],a.email]]),Object(r["I"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"密碼","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.password=e}),autocomplete:"off"},null,512),[[r["E"],a.password]])]),Object(r["g"])("div",k,Object(r["C"])(a.error),1),a.isPending?Object(r["e"])("",!0):(Object(r["u"])(),Object(r["f"])("button",R,"登入")),a.isPending?(Object(r["u"])(),Object(r["f"])("button",I,"登入中...")):Object(r["e"])("",!0)],32)}var A=n("1da1"),L=(n("96cf"),n("260b")),D=(n("e71f"),n("ea7b"),n("66ce"),{apiKey:"AIzaSyDJsSy-Yx5kA95C4ixotoreAOoCSDX6Twg",authDomain:"potato-chatroom.firebaseapp.com",projectId:"potato-chatroom",storageBucket:"potato-chatroom.appspot.com",messagingSenderId:"570591132864",appId:"1:570591132864:web:8572d473306e8555138125"});L["a"].initializeApp(D);var S=L["a"].auth(),P=L["a"].firestore(),N=(L["a"].database(),L["a"].firestore.FieldValue.serverTimestamp),q=(L["a"].firestore.FieldPath,Object(y["l"])(null)),E=Object(y["l"])(!1),M=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return q.value="",E.value=!0,e.prev=2,e.next=5,S.signInWithEmailAndPassword(t,n);case 5:return r=e.sent,q.value=null,E.value=!1,e.abrupt("return",r);case 11:e.prev=11,e.t0=e["catch"](2),console.log(e.t0.message),q.value="帳號或密碼無效，請再輸入一次",E.value=!1;case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){return{error:q,login:M,isPending:E}},W=F,U=Object(y["l"])(S.currentUser);S.onAuthStateChanged((function(e){U.value=e}));var V=function(){return{user:U}},_=V,T=function(e,t){var n=Object(r["x"])(null),a=Object(r["x"])(!1),c=P.collection(e).doc(t),u=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a.value=!0,n.value=null;try{c.set(t)}catch(r){console.log(r.message),n.value="無法新增資料，請再試一次",a.value=!1}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=!0,n.value=null,e.prev=2,e.next=5,c.delete();case 5:return t=e.sent,a.value=!1,e.abrupt("return",t);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),n.value="無法刪除資料，請再試一次",a.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),o=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=!0,n.value=null,e.prev=2,e.next=5,c.update(t);case 5:return r=e.sent,a.value=!1,e.abrupt("return",r);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),n.value="無法更新資料，請再試一次",a.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}();return{error:n,isPending:a,document:document,deleteDoc:s,updateDoc:o,addDoc:u}},K=T,z={components:{useLogin:W,getUser:_,useDocuments:K},setup:function(e,t){var n=Object(y["l"])(""),r=Object(y["l"])(""),a=W(),c=a.error,u=a.login,s=a.isPending,o=_(),i=(o.user,function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u(n.value,r.value);case 2:c.value||t.emit("login");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());return{email:n,password:r,handleSubmit:i,error:c,isPending:s}}};n("9d68");const H=o()(z,[["render",C]]);var J=H,Q={class:"inputs"},B={class:"error"},G={key:0},X={key:1,disabled:""};function Y(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("form",{onSubmit:t[3]||(t[3]=Object(r["K"])((function(){return a.handleSubmit&&a.handleSubmit.apply(a,arguments)}),["prevent"]))},[Object(r["g"])("div",Q,[Object(r["I"])(Object(r["g"])("input",{type:"text",required:"",placeholder:"暱稱 (最多10字，日後可修改)","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.displayName=e}),autocomplete:"off",maxlength:"5"},null,512),[[r["E"],a.displayName]]),Object(r["I"])(Object(r["g"])("input",{type:"email",required:"",placeholder:"電子郵件帳號","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.email=e}),autocomplete:"off"},null,512),[[r["E"],a.email]]),Object(r["I"])(Object(r["g"])("input",{type:"password",required:"",placeholder:"密碼","onUpdate:modelValue":t[2]||(t[2]=function(e){return a.password=e}),autocomplete:"off"},null,512),[[r["E"],a.password]])]),Object(r["g"])("div",B,Object(r["C"])(a.error),1),a.isPending?Object(r["e"])("",!0):(Object(r["u"])(),Object(r["f"])("button",G,"註冊")),a.isPending?(Object(r["u"])(),Object(r["f"])("button",X,"註冊中...")):Object(r["e"])("",!0)],32)}var Z=Object(y["l"])(null),$=Object(y["l"])(!1),ee=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Z.value=null,$.value=!0,e.prev=2,e.next=5,S.createUserWithEmailAndPassword(t,n);case 5:if(a=e.sent,a){e.next=8;break}throw new Error("無法完成註冊");case 8:return e.next=10,a.user.updateProfile({displayName:r});case 10:return $.value=!1,e.abrupt("return",a);case 14:e.prev=14,e.t0=e["catch"](2),console.log(e.t0.message),Z.value=e.t0.message,$.value=!1;case 19:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(t,n,r){return e.apply(this,arguments)}}(),te=function(){return{error:Z,signup:ee,isPending:$}},ne=te,re=function(e){var t=Object(y["l"])(null),n=function(){var n=Object(A["a"])(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.value=null,n.prev=1,n.next=4,P.collection(e).add(r);case 4:n.next=10;break;case 6:n.prev=6,n.t0=n["catch"](1),console.log(n.t0.message),t.value="could not send the message";case 10:case"end":return n.stop()}}),n,null,[[1,6]])})));return function(e){return n.apply(this,arguments)}}(),r=function(){var n=Object(A["a"])(regeneratorRuntime.mark((function n(r,a){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.value=null,n.prev=1,n.next=4,P.collection(e).doc(r).set(a);case 4:n.next=10;break;case 6:n.prev=6,n.t0=n["catch"](1),console.log(n.t0.message),t.value="could not send the message";case 10:case"end":return n.stop()}}),n,null,[[1,6]])})));return function(e,t){return n.apply(this,arguments)}}();return{error:t,addDoc:n,addDocWithId:r}},ae=re,ce={components:{useCollection:ae},setup:function(){var e=Object(y["l"])(""),t=Object(y["l"])(""),n=Object(y["l"])(""),r=ne(),a=r.error,c=r.signup,u=r.isPending,s=ae("users"),o=s.addDocWithId,i=_(),l=i.user,b=Object(d["d"])(),f=function(){var r=Object(A["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,c(e.value,t.value,n.value);case 2:if(a.value){r.next=6;break}return r.next=5,o(l.value.uid,{displayName:l.value.displayName,userId:l.value.uid,statusMessage:"尚未設定狀態",requestIsRead:!0,messageIsRead:!0});case 5:b.push({name:"Chatroom",params:{id:"friendList"}});case 6:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return{email:e,password:t,handleSubmit:f,displayName:n,error:a,signup:c,isPending:u}}};n("8619");const ue=o()(ce,[["render",Y]]);var se=ue,oe={components:{LoginForm:J,SignupForm:se,getUser:_},setup:function(){var e=Object(y["l"])(!0),t=Object(d["d"])(),n=function(){t.push({name:"Chatroom",params:{id:"friendList"}})};return{showLogin:e,enterChatroom:n}}};n("19f5");const ie=o()(oe,[["render",w]]);var le=ie,de={class:"chatroom"};function be(e,t,n,a,c,u){var s=Object(r["A"])("Navbar"),o=Object(r["A"])("Sidebar"),i=Object(r["A"])("Friends"),l=Object(r["A"])("SingleChatroom");return Object(r["u"])(),Object(r["f"])("div",de,[Object(r["i"])(s),Object(r["i"])(o),Object(r["i"])(i),Object(r["i"])(l)])}var fe={key:0,class:"navbar"},pe={class:"display-name"},ve={class:"email"};function me(e,t,n,a,c,u){return a.user&&a.userInfo?(Object(r["u"])(),Object(r["f"])("nav",fe,[Object(r["g"])("div",null,[Object(r["g"])("p",pe,"您好，"+Object(r["C"])(a.userInfo.displayName),1),Object(r["g"])("p",ve,Object(r["C"])(a.user.email),1)]),Object(r["g"])("button",{onClick:t[0]||(t[0]=function(){return a.handleClick&&a.handleClick.apply(a,arguments)})},"登出")])):Object(r["e"])("",!0)}var Oe=Object(y["l"])(null),je=Object(y["l"])(!1),he=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Oe.value=null,je.value=!0,e.prev=2,e.next=5,S.signOut();case 5:je.value=!1,e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](2),console.log(e.t0.message),Oe.value=e.t0.message,je.value=!1;case 13:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),ge=function(){return{logout:he,error:Oe,isPending:je}},we=ge,ye=n("5530"),xe=function(e,t){var n=Object(r["x"])(null),a=Object(r["x"])(null),c=P.collection(e).doc(t),u=c.onSnapshot((function(e){e.data()?(n.value=Object(ye["a"])(Object(ye["a"])({},e.data()),{},{id:e.id}),a.value=null):(a.value="此資料不存在。",n.value=null)}),(function(e){console.log(e.message),a.value="無法取得資料"}));return Object(r["G"])((function(e){e((function(){return u()}))})),{document:n,error:a}},ke=xe,Re={components:{useLogout:we},setup:function(){var e=we(),t=e.logout,n=e.error,r=Object(d["d"])(),a=_(),c=a.user,u=ke("users",c.value.uid),s=u.document,o=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:n.value||r.push({name:"Welcome"});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{user:c,handleClick:o,userInfo:s}}};n("eec7");const Ie=o()(Re,[["render",me]]);var Ce=Ie,Ae={class:"sidebar"},Le={class:"buttons"},De=Object(r["h"])(" people "),Se=Object(r["g"])("p",null,"好友",-1),Pe=[De,Se],Ne=Object(r["h"])(" question_answer "),qe=Object(r["g"])("p",null,"聊天室",-1),Ee=[Ne,qe],Me=Object(r["h"])(" person_add "),Fe=Object(r["g"])("p",null,"加入好友",-1),We=[Me,Fe],Ue=Object(r["h"])(" group_add "),Ve=Object(r["g"])("p",null,"好友邀請",-1),_e=[Ue,Ve],Te=Object(r["h"])("manage_accounts "),Ke=Object(r["g"])("p",null,"關於自己",-1),ze=[Te,Ke];function He(e,t,n,a,c,u){var s,o;return Object(r["u"])(),Object(r["f"])("aside",Ae,[Object(r["g"])("div",Le,[Object(r["g"])("span",{class:Object(r["o"])(["material-icons",{active:"friendList"==a.activeEl}]),onClick:t[0]||(t[0]=function(e){return a.handleClick("friendList"),a.addActive("friendList")})},Pe,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",["chatrooms"==a.activeEl?"active":"",null!==(s=a.document)&&void 0!==s&&s.messageIsRead?"":"new"]]),onClick:t[1]||(t[1]=function(e){a.handleClick("chatrooms"),a.addActive("chatrooms")})},Ee,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",{active:"addFriends"==a.activeEl}]),onClick:t[2]||(t[2]=function(e){a.handleClick("addFriends"),a.addActive("addFriends")})},We,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",["friendRequests"==a.activeEl?"active":"",null!==(o=a.document)&&void 0!==o&&o.requestIsRead?"":"new"]]),onClick:t[3]||(t[3]=function(e){a.handleClick("friendRequests"),a.addActive("friendRequests")})},_e,2),Object(r["g"])("span",{class:Object(r["o"])(["material-icons",{active:"aboutMe"==a.activeEl}]),onClick:t[4]||(t[4]=function(e){a.handleClick("aboutMe"),a.addActive("aboutMe")})},ze,2)])])}var Je={setup:function(){var e=Object(y["l"])(),t=Object(d["d"])(),n=_(),r=n.user,a=r.value.uid,c=ke("users",a),u=c.document,s=function(e){t.push({name:"Chatroom",params:{id:e}})},o=function(t){if(e.value=t,"chatrooms"===t){var n=K("users",a),r=n.updateDoc;r({messageIsRead:!0})}if("friendRequests"===t){var c=K("users",a),u=c.updateDoc;u({requestIsRead:!0})}};return{handleClick:s,activeEl:e,addActive:o,document:u}}};n("25a2");const Qe=o()(Je,[["render",He]]);var Be=Qe,Ge={class:"frineds"},Xe={key:0,class:"friend-list"},Ye={key:1,class:"addFriends"},Ze={key:2,class:"friend-requests"},$e={key:3,class:"about-me"};function et(e,t,n,a,c,u){var s=Object(r["A"])("FriendList"),o=Object(r["A"])("AddFriendList"),i=Object(r["A"])("FriendRequestList"),l=Object(r["A"])("AboutMe"),d=Object(r["A"])("ChatroomList");return Object(r["u"])(),Object(r["f"])("section",Ge,["friendList"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Xe,[Object(r["i"])(s)])):Object(r["e"])("",!0),"addFriends"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Ye,[Object(r["i"])(o)])):Object(r["e"])("",!0),"friendRequests"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Ze,[Object(r["i"])(i)])):Object(r["e"])("",!0),"aboutMe"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",$e,[Object(r["i"])(l)])):Object(r["e"])("",!0),Object(r["i"])(d)])}n("b0c0");var tt=Object(r["g"])("div",{class:"category"},"我的資料",-1),nt={key:0,class:"user-infos"},rt={class:"user-info display-name"},at=Object(r["h"])(" 顯示名稱 "),ct=Object(r["g"])("span",{class:"material-icons"},"edit",-1),ut={class:"user-info status-message"},st=Object(r["h"])(" 狀態消息 "),ot=Object(r["g"])("span",{class:"material-icons"}," edit ",-1),it={class:"user-info user-id"},lt=Object(r["h"])(" 用戶ID "),dt={class:"user-info email"},bt=Object(r["h"])(" 電子郵件帳號 "),ft=Object(r["g"])("div",{class:"user-info developer"},[Object(r["h"])(" 此程式開發者ID（歡迎加我好友） "),Object(r["g"])("p",null,"pvzcHUVscLOjoAOK0eQQxHx3qOV2")],-1),pt={key:1,class:"reminder"};function vt(e,t,n,a,c,u){var s=Object(r["A"])("Loader");return Object(r["u"])(),Object(r["f"])(r["a"],null,[tt,a.userInfo?(Object(r["u"])(),Object(r["f"])("div",nt,[Object(r["g"])("div",rt,[at,Object(r["g"])("p",{onClick:t[0]||(t[0]=function(e){return a.showNameInput=!a.showNameInput,a.showStatusInput=!1})},[Object(r["h"])(Object(r["C"])(a.userInfo.displayName)+" ",1),ct]),Object(r["g"])("form",{onSubmit:t[2]||(t[2]=Object(r["K"])((function(){return a.handleSubmitName&&a.handleSubmitName.apply(a,arguments)}),["prevent"]))},[a.showNameInput?Object(r["I"])((Object(r["u"])(),Object(r["f"])("input",{key:0,type:"text","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.name=e}),placeholder:"請輸入新名稱(十字以內)",maxlength:"10"},null,512)),[[r["E"],a.name]]):Object(r["e"])("",!0)],32)]),Object(r["g"])("div",ut,[st,Object(r["g"])("p",{onClick:t[3]||(t[3]=function(e){return a.showStatusInput=!a.showStatusInput,a.showNameInput=!1})},[Object(r["h"])(Object(r["C"])(a.userInfo.statusMessage)+" ",1),ot]),Object(r["g"])("form",{onSubmit:t[5]||(t[5]=Object(r["K"])((function(){return a.handleSubmitStatus&&a.handleSubmitStatus.apply(a,arguments)}),["prevent"]))},[a.showStatusInput?Object(r["I"])((Object(r["u"])(),Object(r["f"])("input",{key:0,type:"text","onUpdate:modelValue":t[4]||(t[4]=function(e){return a.statusMessage=e}),placeholder:"請輸入新狀態(二十字以內)",maxlength:"20"},null,512)),[[r["E"],a.statusMessage]]):Object(r["e"])("",!0)],32)]),Object(r["g"])("div",it,[lt,Object(r["g"])("p",null,Object(r["C"])(a.user.uid),1)]),Object(r["g"])("div",dt,[bt,Object(r["g"])("p",null,Object(r["C"])(a.user.email),1)]),ft])):(Object(r["u"])(),Object(r["f"])("div",pt,[Object(r["i"])(s)]))],64)}n("d3b7"),n("159b");var mt=function(e,t,n){var a=Object(r["x"])(null),c=Object(r["x"])(!1),u=P.collection(e).doc(t).collection(n),s=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c.value=!0,a.value=null;try{u.add(t)}catch(n){console.log(n.message),a.value="無法新增資料，請再試一次",c.value=!1}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return c.value=!0,a.value=null,e.prev=2,e.next=5,u.doc(t).delete();case 5:return n=e.sent,c.value=!1,e.abrupt("return",n);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),a.value="無法刪除資料，請再試一次",c.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return c.value=!0,a.value=null,e.prev=2,e.next=5,u.doc(t).update(n);case 5:return r=e.sent,c.value=!1,e.abrupt("return",r);case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0.message),a.value="無法更新資料，請再試一次",c.value=!1;case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=null,e.prev=1,e.next=4,u.doc(t).set(n);case 4:return r=e.sent,c.value=!1,e.abrupt("return",r);case 9:e.prev=9,e.t0=e["catch"](1),console.log(e.t0.message),a.value="could not send the message";case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}();return{error:a,isPending:c,document:document,deleteDoc:o,updateDoc:i,addDoc:s,addDocWithId:l}},Ot=mt,jt={class:"loader"};function ht(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("div",jt)}var gt={};n("320b");const wt=o()(gt,[["render",ht]]);var yt=wt,xt={components:{Loader:yt},setup:function(){var e=_(),t=e.user,n=ke("users",t.value.uid),r=n.document,a=K("users",t.value.uid),c=a.updateDoc,u=Object(y["l"])(!1),s=Object(y["l"])(!1),o=[],i=[],l=[],d=t.value.uid,b=Object(y["l"])(""),f=Object(y["l"])(""),p=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.collection("users").doc(t.value.uid).collection("friendList").get().then((function(e){return e.forEach((function(e){return o.push(e.data().userId)}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.collection("users").doc(t.value.uid).collection("chatrooms").get().then((function(e){return e.forEach((function(e){return i.push([e.data().friendId,e.data().chatroomId])}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.collection("users").doc(t.value.uid).collection("sentRequests").get().then((function(e){return e.forEach((function(e){return l.push(e.data().userId)}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(b.value){e.next=3;break}return u.value=!1,e.abrupt("return");case 3:return c({displayName:b.value}),u.value=!1,e.next=7,p();case 7:return o.forEach((function(e){var n=Ot("users",e,"friendList"),r=n.updateDoc;r(t.value.uid,{displayName:b.value})})),e.next=10,v();case 10:return i.forEach((function(e){var t=Ot("users",e[0],"chatrooms"),n=t.updateDoc;n(e[1],{displayName:b.value})})),e.next=13,m();case 13:l.forEach((function(e){var n=Ot("users",e,"friendRequests"),r=n.updateDoc;r(t.value.uid,{displayName:b.value})})),b.value="",o.length=0,i.length=0,l.length=0;case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(f.value){e.next=3;break}return s.value=!1,e.abrupt("return");case 3:return c({statusMessage:f.value}),s.value=!1,e.next=7,p();case 7:o.forEach((function(e){var t=Ot("users",e,"friendList"),n=t.updateDoc;n(d,{statusMessage:f.value})})),f.value="",o.length=0;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{user:t,userInfo:r,name:b,statusMessage:f,showNameInput:u,showStatusInput:s,handleSubmitName:O,handleSubmitStatus:j}}};n("4fa4");const kt=o()(xt,[["render",vt]]);var Rt=kt,It={key:0,class:"chatrooms"},Ct=Object(r["g"])("div",{class:"category"},"聊天室",-1),At={key:0},Lt=["onClick"],Dt={class:"infos"},St={class:"display-name"},Pt={class:"dialog"},Nt={class:"lastInteractTime"},qt={key:1,class:"reminder"},Et={key:2,class:"reminder"};function Mt(e,t,n,a,c,u){var s,o,i=Object(r["A"])("Loader");return"friendList"!==a.routeParams&&"addFriends"!==a.routeParams&&"friendRequests"!==a.routeParams&&"aboutMe"!==a.routeParams?(Object(r["u"])(),Object(r["f"])("div",It,[Ct,(null===(s=a.formattedChatroomList)||void 0===s?void 0:s.length)>0?(Object(r["u"])(),Object(r["f"])("div",At,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.formattedChatroomList,(function(e){return Object(r["u"])(),Object(r["f"])("div",{key:e.chatroomId},[e?(Object(r["u"])(),Object(r["f"])("div",{key:0,class:Object(r["o"])(["friend",{active:e.isActive}]),onClick:function(t){return a.handleClick(null===e||void 0===e?void 0:e.chatroomId)}},[Object(r["g"])("div",Dt,[Object(r["g"])("p",St,Object(r["C"])(e.displayName),1),Object(r["g"])("p",Pt,Object(r["C"])(e.dialog),1)]),Object(r["g"])("p",Nt,Object(r["C"])(e.lastInteractAt),1),Object(r["g"])("p",{class:Object(r["o"])({isRead:!e.isRead})},Object(r["C"])(e.isRead?"":"新訊息"),3)],10,Lt)):Object(r["e"])("",!0)])})),128))])):0===(null===(o=a.formattedChatroomList)||void 0===o?void 0:o.length)?(Object(r["u"])(),Object(r["f"])("div",qt," 請點選好友，開啟專屬聊天室 ")):(Object(r["u"])(),Object(r["f"])("div",Et,[Object(r["i"])(i)]))])):Object(r["e"])("",!0)}n("d81d");var Ft=n("5c40"),Wt=n("2909"),Ut=function(e,t,n,a,c){var u,s,o=Object(r["x"])(null),i=Object(r["x"])(null),l=P.collection(e).doc(t).collection(n);a&&(l=(u=l).orderBy.apply(u,Object(Wt["a"])(a)));c&&(l=(s=l).where.apply(s,Object(Wt["a"])(c)));var d=l.onSnapshot(function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=[],t.docs.forEach(function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a?t.data()[a[0]]&&n.push(Object(ye["a"])(Object(ye["a"])({},t.data()),{},{id:t.id})):n.push(Object(ye["a"])(Object(ye["a"])({},t.data()),{},{id:t.id}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.value=n,i.value=null;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){console.log(e.message),o.value=null,i.value="could not fetch dada"}));return Object(r["G"])((function(e){e((function(){return d()}))})),{documents:o,error:i}},Vt=Ut,_t=n("efaa"),Tt=n("4602"),Kt={components:{Loader:yt},setup:function(){var e=Object(d["d"])(),t=Object(d["c"])(),n=Object(y["l"])(t.params.id),r=_(),a=r.user,c=[],u=a.value.uid,s=K("users",u),o=s.updateDoc,i=Vt("users",u,"chatrooms",["chatroomOrder","desc"],["isDisplay","==",!0]),l=i.documents,b=Object(y["c"])((function(){if(l.value)return l.value.map((function(e){if(e.lastInteractAt){var t=Object(_t["a"])(Object(Tt["a"])(e.lastInteractAt),{hour:"numeric",minute:"numeric"});return o({messageIsRead:!0}),Object(ye["a"])(Object(ye["a"])({},e),{},{lastInteractAt:t})}var n=Object(_t["a"])(Object(Tt["a"])((new Date).getTime()/1e3),{hour:"numeric",minute:"numeric"});return c.length=0,c.push(n),o({messageIsRead:!0}),Object(ye["a"])(Object(ye["a"])({},e),{},{lastInteractAt:c[0]})}))}));Object(Ft["R"])((function(){n.value=t.params.id}));var f=function(){var t=Object(A["a"])(regeneratorRuntime.mark((function t(r){var a,c,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,null===(a=P.collection("users").doc(u).collection("chatrooms").where("isActive","==",!0))||void 0===a?void 0:a.get().then((function(e){return e.forEach((function(e){console.log("hi"),e.ref.update({isActive:!1})}))}));case 2:return c=Ot("users",u,"chatrooms"),s=c.updateDoc,t.next=5,e.push({name:"Chatroom",params:{id:r}});case 5:return t.next=7,s(n.value,{isActive:!0});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{handleClick:f,routeParams:n,formattedChatroomList:b}}};n("601a");const zt=o()(Kt,[["render",Mt]]);var Ht=zt,Jt=Object(r["g"])("p",{class:"category"},"自己",-1),Qt={key:0,class:"friend"},Bt={class:"infos"},Gt={class:"display-name"},Xt={class:"statusMessage"},Yt=Object(r["g"])("p",{class:"category"},"好友列表",-1),Zt={key:1},$t=["onClick"],en={class:"infos"},tn={class:"display-name"},nn={class:"statusMessage"},rn={key:2,class:"reminder"},an={key:3,class:"reminder"};function cn(e,t,n,a,c,u){var s,o,i=Object(r["A"])("Loader");return Object(r["u"])(),Object(r["f"])(r["a"],null,[Jt,a.userInfo?(Object(r["u"])(),Object(r["f"])("div",Qt,[Object(r["g"])("div",Bt,[Object(r["g"])("p",Gt,Object(r["C"])(a.userInfo.displayName),1),Object(r["g"])("p",Xt,Object(r["C"])(a.userInfo.statusMessage),1)])])):Object(r["e"])("",!0),Yt,(null===(s=a.friendList)||void 0===s?void 0:s.length)>0?(Object(r["u"])(),Object(r["f"])("div",Zt,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.friendList,(function(e){return Object(r["u"])(),Object(r["f"])("div",{class:"friend",key:e.chatroomId,onClick:function(t){return a.handleClick(e.chatroomId)}},[Object(r["g"])("div",en,[Object(r["g"])("p",tn,Object(r["C"])(e.displayName),1),Object(r["g"])("p",nn,Object(r["C"])(e.statusMessage),1)])],8,$t)})),128))])):0===(null===(o=a.friendList)||void 0===o?void 0:o.length)?(Object(r["u"])(),Object(r["f"])("div",rn,"請先新增好友")):(Object(r["u"])(),Object(r["f"])("div",an,[Object(r["i"])(i)]))],64)}var un={components:{Loader:yt},setup:function(){var e=Object(d["d"])(),t=_(),n=t.user,r=n.value.displayName,a=ke("users",n.value.uid),c=a.document,u=Vt("users",n.value.uid,"friendList"),s=u.documents,o=u.error,i=(n.value.uid,function(){var t=Object(A["a"])(regeneratorRuntime.mark((function t(r){var a,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.value){t.next=2;break}return t.abrupt("return");case 2:return e.push({name:"Chatroom",params:{id:r}}),a=Ot("users",n.value.uid,"chatrooms"),c=a.updateDoc,u=Ot("users",n.value.uid,"chatrooms").updateDoc,t.next=7,u(r,{isDisplay:!0});case 7:return t.next=9,c(r,{isActive:!0});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());return{handleClick:i,userDisplayName:r,userInfo:c,friendList:s,error:o,Loader:yt}}};n("d450");const sn=o()(un,[["render",cn]]);var on=sn,ln=Object(r["g"])("div",{class:"category"},"加入好友",-1),dn=Object(r["g"])("span",{class:"material-icons"}," search ",-1),bn={class:"userInfo"},fn={key:0,class:"display-name"},pn={key:1,class:"error"};function vn(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])(r["a"],null,[ln,Object(r["g"])("form",{onSubmit:t[1]||(t[1]=Object(r["K"])((function(e){return a.handleSubmit(a.userId)}),["prevent"]))},[Object(r["I"])(Object(r["g"])("input",{placeholder:"請輸入用戶ID","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.userId=e})},null,512),[[r["E"],a.userId]]),dn],32),Object(r["g"])("div",bn,[a.document?(Object(r["u"])(),Object(r["f"])("div",fn,Object(r["C"])(a.document.displayName),1)):Object(r["e"])("",!0),a.error?(Object(r["u"])(),Object(r["f"])("div",pn,Object(r["C"])(a.error),1)):Object(r["e"])("",!0),a.buttonText?(Object(r["u"])(),Object(r["f"])("button",{key:2,onClick:t[2]||(t[2]=function(e){return a.handleClick(a.userId)})},Object(r["C"])(a.buttonText),1)):Object(r["e"])("",!0)])],64)}n("498a"),n("caad");var mn={setup:function(){var e=Object(y["l"])(),t=Object(y["l"])(),n=Object(y["l"])(),r=Object(y["l"])(),a=[],c=[],u=[],s=_(),o=s.user,i=function(){var a=Object(A["a"])(regeneratorRuntime.mark((function a(s){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s){a.next=2;break}return a.abrupt("return");case 2:return s=s.trim(),a.next=5,P.collection("users").doc(o.value.uid).collection("sentRequests").get().then((function(e){return e.forEach((function(e){return u.push(e.data().userId)}))}));case 5:return a.next=7,P.collection("users").doc(o.value.uid).collection("friendList").get().then((function(e){e.forEach((function(e){c.push(e.data().userId)}))}));case 7:return a.next=9,P.collection("users").doc(s).get().then((function(e){return e}));case 9:if(i=a.sent,!u.includes(s)){a.next=17;break}return n.value=i.data(),r.value="您已寄出過邀請囉！請等待對方回覆",e.value="",u.length=0,c.length=0,a.abrupt("return");case 17:if(!c.includes(s)){a.next=24;break}return n.value=i.data(),r.value="你們已是好友囉！",e.value="",u.length=0,c.length=0,a.abrupt("return");case 24:if(s!==o.value.uid){a.next=31;break}return n.value=i.data(),r.value="這是您自己哦！",e.value="",u.length=0,c.length=0,a.abrupt("return");case 31:i.exists?(r.value="",t.value="加入",n.value=i.data(),u.length=0,c.length=0):(r.value="Oops...查無此ID",n.value="",t.value="",e.value="",u.length=0,c.length=0);case 32:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),l=function(){var r=Object(A["a"])(regeneratorRuntime.mark((function r(c){var u,s,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return u={displayName:a[0].displayName,userId:a[0].userId},s=K("users",c),i=s.updateDoc,r.next=4,Ot("users",c,"friendRequests").addDocWithId(o.value.uid,u);case 4:return r.next=6,Ot("users",o.value.uid,"sentRequests").addDocWithId(c,{userId:c});case 6:return r.next=8,i({requestIsRead:!1});case 8:e.value="",n.value="",t.value="",a.length=0;case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return Object(Ft["R"])(Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o.value){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,P.collection("users").doc(o.value.uid).get().then((function(e){a.push(e.data())}));case 4:case"end":return e.stop()}}),e)})))),{userId:e,handleSubmit:i,document:n,error:r,buttonText:t,handleClick:l}}};n("a5ac");const On=o()(mn,[["render",vn]]);var jn=On,hn=Object(r["g"])("p",{class:"category"},"好友邀請",-1),gn={key:0},wn={class:"display-name"},yn={class:"buttons"},xn=["onClick"],kn=["onClick"],Rn={key:1,class:"reminder"},In={key:2,class:"reminder"};function Cn(e,t,n,a,c,u){var s,o,i=Object(r["A"])("Loader");return Object(r["u"])(),Object(r["f"])(r["a"],null,[hn,"friendList"!==a.routeParams&&"addFriends"!==a.routeParams&&"chatrooms"!==a.routeParams&&"aboutMe"!==a.routeParams&&(null===(s=a.requests)||void 0===s?void 0:s.length)>0?(Object(r["u"])(),Object(r["f"])("div",gn,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.requests,(function(e){return Object(r["u"])(),Object(r["f"])("div",{class:"request",key:e.userId},[Object(r["g"])("p",wn,Object(r["C"])(e.displayName),1),Object(r["g"])("div",yn,[Object(r["g"])("button",{class:"delete",onClick:function(t){return a.handleDelete(e.userId)}}," 刪除 ",8,xn),Object(r["g"])("button",{class:"accept",onClick:function(t){return a.handleAccept(e.userId,e.displayName)}}," 接受 ",8,kn)])])})),128))])):0===(null===(o=a.requests)||void 0===o?void 0:o.length)?(Object(r["u"])(),Object(r["f"])("div",Rn," 目前尚無好友邀請 ")):(Object(r["u"])(),Object(r["f"])("div",In,[Object(r["i"])(i)]))],64)}var An={components:{Loader:yt},setup:function(){var e=n("4487"),t=Object(d["c"])(),r=Object(y["l"])(t.params.id),a=[],c=[],u=_(),s=u.user,o=s.value.uid,i=K("users",o),l=i.updateDoc,b=Vt("users",s.value.uid,"friendRequests"),f=b.documents,p=Object(y["c"])((function(){if(f.value)return l({requestIsRead:!0}),f.value}));Object(Ft["Q"])(t,Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.value=t.params.id;case 1:case"end":return e.stop()}}),e)}))));var v=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Ot("users",s.value.uid,"friendRequests").deleteDoc(t),Ot("users",t,"sentRequests").deleteDoc(s.value.uid);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var t=Object(A["a"])(regeneratorRuntime.mark((function t(n){var r,u,o,i,l,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.generate(20);case 2:return r=t.sent,t.next=5,P.collection("users").doc(s.value.uid).get().then((function(e){a.push(e.data())}));case 5:return t.next=7,P.collection("users").doc(n).get().then((function(e){c.push(e.data())}));case 7:return u={chatroomId:r,usersId:[n,s.value.uid]},ae("chatrooms").addDocWithId(r,u),o={chatroomId:r,displayName:c[0].displayName,friendId:c[0].userId,lastInteractAt:N(),chatroomOrder:N(),lastRead:N(),isActive:!1,isDisplay:!1,isRead:!0},i={chatroomId:r,userId:c[0].userId,displayName:c[0].displayName,statusMessage:c[0].statusMessage},l={chatroomId:r,lastInteractAt:N(),chatroomOrder:N(),lastRead:N(),displayName:a[0].displayName,friendId:a[0].userId,isDisplay:!1,isRead:!0,isActive:!1},d={chatroomId:r,userId:a[0].userId,displayName:a[0].displayName,statusMessage:a[0].statusMessage},t.next=15,Ot("users",a[0].userId,"chatrooms").addDocWithId(r,o);case 15:return t.next=17,Ot("users",c[0].userId,"chatrooms").addDocWithId(r,l);case 17:return t.next=19,Ot("users",a[0].userId,"friendList").addDocWithId(c[0].userId,i);case 19:return t.next=21,Ot("users",c[0].userId,"friendList").addDocWithId(a[0].userId,d);case 21:return t.next=23,Ot("users",a[0].userId,"friendRequests").deleteDoc(c[0].userId);case 23:return t.next=25,Ot("users",c[0].userId,"sentRequests").deleteDoc(a[0].userId);case 25:c.length=0,a.length=0;case 27:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{routeParams:r,requests:p,handleDelete:v,handleAccept:m}}};n("e1f1");const Ln=o()(An,[["render",Cn]]);var Dn=Ln,Sn={key:0,class:"reminder"},Pn=Object(r["g"])("p",null,[Object(r["h"])("點選好友"),Object(r["g"])("br"),Object(r["h"])("進入專屬聊天室")],-1),Nn=[Pn],qn={key:1,class:"reminder"},En=Object(r["g"])("p",null,[Object(r["h"])("輸入用戶ID"),Object(r["g"])("br"),Object(r["h"])("並加入好友")],-1),Mn=[En],Fn={key:2,class:"reminder"},Wn=Object(r["g"])("p",null,"接受/刪除好友邀請",-1),Un=[Wn],Vn={key:3,class:"reminder"},_n=Object(r["g"])("p",null,"個人資料設定",-1),Tn=[_n],Kn={key:4,class:"reminder"},zn=Object(r["g"])("p",null,[Object(r["h"])("點選左方聊天室 "),Object(r["g"])("br"),Object(r["h"])("方可開始聊天")],-1),Hn=[zn],Jn={key:5,class:"chat-window"};function Qn(e,t,n,a,c,u){var s=Object(r["A"])("displayName"),o=Object(r["A"])("messages"),i=Object(r["A"])("newChatForm");return Object(r["u"])(),Object(r["f"])("main",{class:Object(r["o"])([{showSingleChatroom:a.showSingleChatroom},"single-chatroom"])},["friendList"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Sn,Nn)):"addFriends"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",qn,Mn)):"friendRequests"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Fn,Un)):"aboutMe"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Vn,Tn)):"chatrooms"===a.routeParams?(Object(r["u"])(),Object(r["f"])("div",Kn,Hn)):(Object(r["u"])(),Object(r["f"])("div",Jn,[Object(r["i"])(s),Object(r["i"])(o),Object(r["i"])(i)]))],2)}var Bn={key:0,class:"displayName"},Gn={key:1};function Xn(e,t,n,a,c,u){return a.formattedChatroomList?(Object(r["u"])(),Object(r["f"])("div",Bn,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.formattedChatroomList,(function(e){return Object(r["u"])(),Object(r["f"])("div",{key:e.chatroomId},[Object(r["g"])("p",null,Object(r["C"])(e.displayName),1)])})),128))])):(Object(r["u"])(),Object(r["f"])("div",Gn))}var Yn={setup:function(){var e=_(),t=e.user,n=Vt("users",t.value.uid,"chatrooms","",["isActive","==",!0]).documents,r=Object(y["c"])((function(){var e;if((null===(e=n.value)||void 0===e?void 0:e.length)>0)return n.value.map((function(e){return e}))}));return{formattedChatroomList:r}}};n("45fc");const Zn=o()(Yn,[["render",Xn]]);var $n=Zn,er={key:0,class:"messages",ref:"messages"},tr={class:"message-info"},nr={class:"is-read"},rr={class:"created-at"},ar={class:"content"};function cr(e,t,n,a,c,u){return a.routeParams?(Object(r["u"])(),Object(r["f"])("div",er,[(Object(r["u"])(!0),Object(r["f"])(r["a"],null,Object(r["y"])(a.formattedMessages(),(function(e){var t,n;return Object(r["u"])(),Object(r["f"])("div",{class:Object(r["o"])(["message",{friendMessage:e.userId!==(null===(t=a.user)||void 0===t?void 0:t.uid),myMessage:e.userId===(null===(n=a.user)||void 0===n?void 0:n.uid)}]),key:e.id},[Object(r["g"])("div",tr,[Object(r["g"])("p",nr,Object(r["C"])(e.isRead?"已讀":""),1),Object(r["g"])("p",rr,Object(r["C"])(e.createdAt),1)]),Object(r["g"])("p",ar,Object(r["C"])(e.message),1)],2)})),128))],512)):Object(r["e"])("",!0)}var ur={setup:function(){var e=_(),t=e.user,n=Object(d["c"])(),r=Object(y["l"])(""),a=Object(y["l"])(null),c=Object(y["l"])(""),u=[],s=Object(y["l"])(t.value.uid),o=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.collection("users").doc(t.value.uid).collection("chatrooms").doc(n.params.id).get().then((function(e){return u.push({lastRead:e.data().lastRead.seconds,lastInteractAt:e.data().lastInteractAt.seconds})}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){if(c.value)return c.value.map((function(e){var t=Object(_t["a"])(Object(Tt["a"])(e.createdAt),{hour:"numeric",minute:"numeric"});return P.collection("chatrooms").doc(r.value).collection("messages").where("isRead","==",!1).where("userId","!=",s.value).get().then((function(e){e.forEach((function(e){e.ref.update({isRead:!0})}))})),Object(ye["a"])(Object(ye["a"])({},e),{},{createdAt:t})}))};return Object(Ft["R"])(Object(A["a"])(regeneratorRuntime.mark((function e(){var a,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.value){e.next=2;break}return e.abrupt("return");case 2:if("friendList"!==n.params.id&&"addFriends"!==n.params.id&&"friendRequests"!==n.params.id&&"chatrooms"!==n.params.id&&"aboutMe"!==n.params.id&&n.params.id){e.next=4;break}return e.abrupt("return");case 4:return r.value=n.params.id,c=Vt("chatrooms",r.value,"messages",["createdAt"]).documents,a=Ot("users",t.value.uid,"chatrooms"),u=a.updateDoc,e.next=9,P.collection("chatrooms").doc(r.value).collection("messages").where("isRead","==",!1).where("userId","!=",s.value).get().then((function(e){e.forEach((function(e){e.ref.update({isRead:!0})}))}));case 9:return e.next=11,o();case 11:return e.next=13,u(r.value,{isRead:!0,lastRead:N()});case 13:case"end":return e.stop()}}),e)})))),Object(Ft["B"])((function(){a.value&&(a.value.scrollTop=a.value.scrollHeight)})),{user:t,formattedMessages:i,routeParams:r,messages:a}}};n("3a40");const sr=o()(ur,[["render",cr]]);var or=sr,ir={class:"chat-form"};function lr(e,t,n,a,c,u){return Object(r["u"])(),Object(r["f"])("form",ir,[Object(r["I"])(Object(r["g"])("textarea",{placeholder:"輸入訊息","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.message=e}),onKeypress:t[1]||(t[1]=Object(r["J"])(Object(r["K"])((function(e){return a.width>768?a.handleSubmit():a.handleLineFeed()}),["prevent"]),["enter"]))},null,544),[[r["E"],a.message]]),Object(r["g"])("span",{class:"material-icons",onClick:t[2]||(t[2]=function(){return a.handleSubmit&&a.handleSubmit.apply(a,arguments)})}," send ")])}var dr=function(){let e=Object(r["x"])(window.innerWidth);const t=()=>e.value=window.innerWidth;Object(r["s"])(()=>window.addEventListener("resize",t)),Object(r["t"])(()=>window.removeEventListener("resize",t));const n=Object(r["b"])(()=>e.value<550?"xs":e.value>=550&&e.value<1200?"md":e.value>=1200?"lg":null),a=Object(r["b"])(()=>e.value);return{width:a,type:n}},br={setup:function(){var e=_(),t=e.user,n=Object(y["l"])(""),r=Object(d["c"])(),a=Object(y["l"])(!1),c=Object(y["l"])(),u=Object(y["l"])(t.value.uid),s=[],o=dr(),i=o.width,l=Object(y["l"])(""),b=Ot("chatrooms",r.params.id,"messages"),f=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.collection("users").doc(c.value).collection("chatrooms").doc(r.params.id).get().then((function(e){return s.push({lastRead:e.data().lastRead.seconds,lastInteractAt:e.data().lastInteractAt.seconds,isActive:e.data().isActive})}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(Ft["R"])(Object(A["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r.params.id){e.next=6;break}return e.next=3,Ot("chatrooms",r.params.id,"messages");case 3:b=e.sent,a.value=!0,console.log(a.value);case 6:case"end":return e.stop()}}),e)}))));var p=function(){console.log("換行"),n.value=n.value+"\n"},v=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(){var o,i,l,d,p,v,m,O;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("hi"),e.next=3,P.collection("chatrooms").doc(r.params.id).get().then((function(e){return e.data().usersId}));case 3:return o=e.sent,o[0]===t.value.uid?c.value=o[1]:c.value=o[0],e.next=7,P.collection("users").doc(u.value).collection("chatrooms").doc(r.params.id);case 7:return i=e.sent,e.next=10,P.collection("users").doc(c.value).collection("chatrooms").doc(r.params.id);case 10:if(l=e.sent,d={userId:u.value,isRead:!1,message:n.value,createdAt:N()},n.value="",d.message){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,b.addDoc(d);case 17:return e.next=19,i.update(Object(ye["a"])({dialog:d.message,lastInteractAt:N(),isDisplay:!0},a.value&&{chatroomOrder:N()}));case 19:return e.next=21,l.update(Object(ye["a"])({dialog:d.message,lastInteractAt:d.createdAt,isDisplay:!0},a.value&&{chatroomOrder:d.createdAt}));case 21:return a.value=!1,p=Ot("users",c.value,"chatrooms"),v=p.updateDoc,e.next=25,f();case 25:return e.next=27,v(r.params.id,Object(ye["a"])(Object(ye["a"])({},!s[0].isActive&&{isRead:s[0].lastRead>s[0].lastInteractAt}),{},{lastRead:N()}));case 27:return m=K("users",c.value),O=m.updateDoc,e.next=30,O(Object(ye["a"])({},!s[0].isActive&&{messageIsRead:!1}));case 30:s.length=0;case 31:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{message:n,handleSubmit:v,width:i,handleLineFeed:p,placeholder:l}}};n("30c4");const fr=o()(br,[["render",lr]]);var pr=fr,vr={components:{displayName:$n,messages:or,newChatForm:pr},setup:function(){var e=Object(y["l"])(""),t=Object(d["c"])(),n=Object(y["l"])(!1),r=dr(),a=r.width,c=["friendList","chatrooms","addFriends","friendRequests","aboutMe"];return Object(Ft["R"])((function(){e.value=t.params.id,a.value<768?c.includes(e.value)?n.value=!1:n.value=!0:n.value=!1})),{routeParams:e,showSingleChatroom:n}}};n("d434");const mr=o()(vr,[["render",Qn]]);var Or=mr,jr={components:{SingleChatroom:Or,FriendList:on,ChatroomList:Ht,AddFriendList:jn,FriendRequestList:Dn,AboutMe:Rt},setup:function(){var e=Object(d["c"])(),t=Object(y["l"])(e.params.id),n=_(),r=n.user;r.value.uid;Object(Ft["Q"])(e,Object(A["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a(t.value),t.value=e.params.id;case 2:case"end":return n.stop()}}),n)}))));var a=function(){var e=Object(A["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{routeParams:t}}};n("b73d");const hr=o()(jr,[["render",et]]);var gr=hr,wr={props:["id"],components:{Navbar:Ce,Sidebar:Be,Friends:gr,SingleChatroom:Or},setup:function(){}};n("852f");const yr=o()(wr,[["render",be]]);var xr,kr=yr,Rr=function(e,t,n){var r=S.currentUser;r?n():n({name:"Welcome"})},Ir=function(e,t,n){var r=S.currentUser;r?n({name:"Chatroom",params:{id:"chatrooms"}}):n()},Cr=[{path:"/",name:"Welcome",component:le,beforeEnter:Ir},{path:"/chatroom/:id",name:"Chatroom",component:kr,beforeEnter:Rr,props:!0}],Ar=Object(d["a"])({history:Object(d["b"])("/"),routes:Cr}),Lr=Ar;n("845f");S.onAuthStateChanged((function(){xr||(xr=Object(r["c"])(l).use(Lr).mount("#app"))}))},6:function(e,t){},"601a":function(e,t,n){"use strict";n("fc04")},6308:function(e,t,n){},"6f6b":function(e,t,n){},7:function(e,t){},8:function(e,t){},8285:function(e,t,n){},"845f":function(e,t,n){},"852f":function(e,t,n){"use strict";n("6f6b")},8619:function(e,t,n){"use strict";n("935e")},9:function(e,t){},"935e":function(e,t,n){},"9d04":function(e,t,n){},"9d68":function(e,t,n){"use strict";n("d21f")},a05a:function(e,t,n){},a5ac:function(e,t,n){"use strict";n("1e68")},b73d:function(e,t,n){"use strict";n("9d04")},c753:function(e,t,n){},d21f:function(e,t,n){},d434:function(e,t,n){"use strict";n("4c3d")},d450:function(e,t,n){"use strict";n("8285")},daf7:function(e,t,n){},e1f1:function(e,t,n){"use strict";n("2cbe")},e3d1:function(e,t,n){"use strict";n("daf7")},eec7:function(e,t,n){"use strict";n("3e42")},fc04:function(e,t,n){}});
//# sourceMappingURL=app.2c5598ea.js.map